/*!
 * SharepointPlus v5.0
 * Copyright 2017, Aymeric (@aymkdn)
 * Contact: http://kodono.info
 * Documentation: http://aymkdn.github.com/SharepointPlus/
 * License: LGPL-3 (http://aymkdn.github.com/SharepointPlus/license.md)
 */
var SPIsArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},SPArrayIndexOf=function(e,t){"use strict";if(Array.prototype.indexOf)return e.indexOf(t);var r=Object(e),n=r.length>>>0;if(0===n)return-1;var o=0;if(arguments.length>1&&(o=Number(arguments[1]),o!=o?o=0:0!=o&&o!=1/0&&o!=-(1/0)&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=n)return-1;for(var i=o>=0?o:Math.max(n-Math.abs(o),0);n>i;i++)if(i in r&&r[i]===t)return i;return-1},SPArrayForEach=function(e,t,r){"use strict";if(Array.prototype.forEach)return e.forEach(t,r);var n,o;if(null==e)throw new TypeError(" this is null or not defined");var i=Object(e),a=i.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=r),o=0;a>o;){var s;o in i&&(s=i[o],t.call(n,s,o,i)),o++}};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var SPArrayChunk=function(e,t){for(var r=[],n=0,o=e.length;o>n;n+=t)r.push(e.slice(n,n+t));return r},SPExtend=function(){var e,t,r,n,o=arguments[0]||{},i=1,a=arguments.length,s=!1,l=function(e){if(null===e||"object"!=typeof e||e.nodeType||null!==e&&e===e.window)return!1;try{if(e.constructor&&!this.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0};for("boolean"==typeof o&&(s=o,o=arguments[i]||{},i++),"object"!=typeof o&&"function"!=typeof o&&(o={}),!1;a>i;i+=1)if(null!==(e=arguments[i]))for(t in e)o!==e[t]&&"undefined"==typeof o[t]&&(s&&e[t]&&(l(e[t])||(r=Array.isArray(e[t])))?(r?(r=!1,n=o[t]&&Array.isArray(o[t])?o[t]:[]):n=o[t]&&l(o[t])?o[t]:{},o[t]=SPExtend(s,n,e[t])):void 0!==e[t]&&(o[t]=e[t]));return o},SPArrayBufferToBase64=function(e){for(var t,r,n,o,i,a="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=new Uint8Array(e),u=l.byteLength,c=u%3,d=u-c,f=0;d>f;f+=3)i=l[f]<<16|l[f+1]<<8|l[f+2],t=(16515072&i)>>18,r=(258048&i)>>12,n=(4032&i)>>6,o=63&i,a+=s[t]+s[r]+s[n]+s[o];return 1==c?(i=l[d],t=(252&i)>>2,r=(3&i)<<4,a+=s[t]+s[r]+"=="):2==c&&(i=l[d]<<8|l[d+1],t=(64512&i)>>10,r=(1008&i)>>4,n=(15&i)<<2,a+=s[t]+s[r]+s[n]+"="),a},_SP_CACHE_FORMFIELDS=null,_SP_CACHE_CONTENTTYPES=[],_SP_CACHE_CONTENTTYPE=[],_SP_CACHE_SAVEDVIEW=[],_SP_CACHE_SAVEDVIEWS=[],_SP_CACHE_SAVEDLISTS=void 0,_SP_CACHE_USERGROUPS=[],_SP_CACHE_GROUPMEMBERS=[],_SP_CACHE_DISTRIBUTIONLISTS=[],_SP_CACHE_REGIONALSETTINGS=void 0,_SP_CACHE_DATEFORMAT=void 0,_SP_CACHE_HASREST={},_SP_CACHE_REQUESTDIGEST={},_SP_ADD_PROGRESSVAR={},_SP_UPDATE_PROGRESSVAR={},_SP_MODERATE_PROGRESSVAR={},_SP_REMOVE_PROGRESSVAR={},_SP_BASEURL=void 0,_SP_NOTIFY_READY=!1,_SP_NOTIFY_QUEUE=[],_SP_NOTIFY=[],_SP_PLUGINS={},_SP_MODALDIALOG_LOADED=!1,_SP_MAXWHERE_ONLOOKUP=30,_SP_ISBROWSER=new Function("try {return this===window;}catch(e){ return false;}")(),_SP_JSON_ACCEPT="verbose";"function"==typeof jQuery&&$(".ms-lookuptypeintextbox").each(function(){for(var e=$(this),t=$("#"+e.attr("optHid")).val(),r=e.attr("choices").split("|"),n='<select id="'+e.attr("id")+'_Lookup" name="'+e.attr("name").replace(/\_/g,"$")+'" data-info="This SELECT has been created by SharepointPlus" title="'+e.attr("title")+'">',o=0;o<r.length;o+=2)n+='<option value="'+r[o+1]+'"'+(r[o+1]==t?' selected="selected"':"")+">"+r[o]+"</option>";n+="</select>",e.closest("span").hide().before(n),$("#"+e.attr("id")+"_Lookup").on("change",function(){var e=$("#"+$(this).attr("id").slice(0,-7)),t=$("#"+e.attr("optHid")),r=$(this).val();t.val(r),e.val($(this).find("option[value='"+("0"!==r?r:"")+"']").text())}).trigger("change")}),function(window,document,undefined){function SharepointPlus(){return this instanceof arguments.callee?void 0:new arguments.callee}var fastMap=function(e,t){for(var r=e.length,n=new Array(r),o=r/8,i=r%8,a=r-1;a>-1;a--){var s=o,l=i;do{switch(l){case 0:n[a]=t(e[a]),a--;case 7:n[a]=t(e[a]),a--;case 6:n[a]=t(e[a]),a--;case 5:n[a]=t(e[a]),a--;case 4:n[a]=t(e[a]),a--;case 3:n[a]=t(e[a]),a--;case 2:n[a]=t(e[a]),a--;case 1:n[a]=t(e[a]),a--}l=0}while(--s>0)}return n};SharepointPlus.prototype={data:[],length:0,listQueue:[],needQueue:!1,module_sprequest:null,credentialOptions:null,proxyweb:null,hasPromise:"function"==typeof Promise||"function"==typeof jQuery,getVersion:function(){return"4.1"},hasREST:function(e){var t=this;return t._promise(function(r){e=e||{};var n=(e.url||t.url||window.location.href).split("/").slice(0,3).join("/");if("function"==typeof e.callback&&(r=e.callback),"boolean"==typeof _SP_CACHE_HASREST[n])return void r(_SP_CACHE_HASREST[n]);var o,i=!(!e.url&&_SP_ISBROWSER&&"undefined"!=typeof SP);if(!i){if("undefined"!=typeof SP&&SP.ClientSchemaVersions)return o=parseInt(SP.ClientSchemaVersions.currentVersion)>14,_SP_CACHE_HASREST[n]=o,void r(o);i=!0}i?t.ajax({method:"GET",url:n+"/_api/web/Url",success:function(){_SP_CACHE_HASREST[n]=!0,r(!0)},error:function(){_SP_CACHE_HASREST[n]=!1,r(!1)}}):(_SP_CACHE_HASREST[n]=!1,r(!1))})},_getRequestDigest:function(e){var t=this;return t._promise(function(r,n){var o,i,a=(e.url||t.url||window.location.href).split("/").slice(0,3).join("/");return e.callback&&(r=e.callback),i=_SP_CACHE_REQUESTDIGEST[a],i&&(new Date).getTime()-new Date(i.split(",")[1]).getTime()<864e5?void r(i):_SP_ISBROWSER&&document&&(o=document.querySelector("#__REQUESTDIGEST"))?(i=o.value,_SP_CACHE_REQUESTDIGEST[a]=i,void r(i)):void t.ajax({url:a+"/_api/contextinfo",method:"POST",success:function(e){i=e.d.GetContextWebInformation.FormDigestValue,_SP_CACHE_REQUESTDIGEST[a]=i,r(i)},error:function(e,t,r){n(r)}})})},decode_b64:function(e,t,r,n,o,i,a){for(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=i=a="";r=e.charAt(a++);~r&&(n=i%4?64*n+r:r,i++%4)?o+=String.fromCharCode(255&n>>(-2*i&6)):0)r=t.indexOf(r);return o},encode_b64:function(e,t,r,n,o,i){for(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="=",n=i="";o&=3,e.charAt(n++)||(t="=",o);i+=t.charAt(63&r>>2*++o))r=r<<8|e.charCodeAt(n-=!o);return i},ajax:function(e){var t,r,n=this;e.headers=e.headers||{};var o=e.headers;return n._promise(function(i,a){var s="function"==typeof e.success;if(s&&(i=e.success,a=e.error||function(){}),e.url.indexOf("/_api/")>-1&&(o.Accept||(o.Accept="application/json;odata="+_SP_JSON_ACCEPT),o["Content-Type"]||(o["Content-Type"]="application/json;odata="+_SP_JSON_ACCEPT),!o["X-RequestDigest"]&&-1===e.url.indexOf("contextinfo")))return void n._getRequestDigest({callback:function(t){o["X-RequestDigest"]=t,s?n.ajax(e):n.ajax(e).then(function(e){i(e)},function(e){a(e)})}});if("undefined"!=typeof jQuery&&jQuery.ajax)"function"==typeof e.onprogress&&(e.processData=!1,e.xhr=function(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",e.onprogress,!1),t}),s?jQuery.ajax(e):jQuery.ajax(e).then(function(e){i(e)},function(e){a(e)});else if(o["Content-Type"]||(o["Content-Type"]=e.contentType||"text/xml; charset=utf-8"),_SP_ISBROWSER){if("undefined"==typeof nanoajax)throw"[SharepointPlus] Fatal Error : No AJAX library has been found... Please use jQuery or nanoajax";"function"==typeof e.beforeSend&&(t={setRequestHeader:function(e,t){o[e]=t}},e.beforeSend(t)),r={url:e.url,method:e.method||"POST",headers:o,body:e.data},"function"==typeof e.onprogress&&(r.onprogress=e.onprogress),nanoajax.ajax(r,function(t,r,n){200===t&&"Error"!==r&&"Abort"!==r&&"Timeout"!==r?s?e.success(n.responseXML||n.responseText):i(n.responseXML||n.responseText):("function"==typeof e.error&&e.error(n,t,r),s||a(r))})}else{if(null===n.module_sprequest){if(null===n.credentialOptions)throw"[SharepointPlus] Error 'ajax': please use `$SP().auth()` to provide your credentials first";n.module_sprequest=require("sp-request").create(n.credentialOptions)}o["Content-Type"].indexOf("xml")>-1&&(o.Accept="application/xml, text/xml, */*; q=0.01"),e.method&&"POST"!==e.method.toLowerCase()||(o["Content-Length"]=Buffer.byteLength(e.data)),"function"==typeof e.beforeSend&&(t={setRequestHeader:function(e,t){o[e]=t}},e.beforeSend(t)),o["User-Agent"]="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:52.0) Gecko/20100101 Firefox/52.0";var l={json:!1,method:e.method||"POST",body:e.data,strictSSL:!1,headers:o,jar:!0};n.proxyweb&&(l.proxy=n.proxyweb),n.module_sprequest(e.url,l).then(function(t){if(200===t.statusCode&&"Error"!==t.statusMessage&&"Abort"!==t.statusMessage&&"Timeout"!==t.statusMessage)if(t.headers["content-type"].indexOf("xml")>-1&&"<?xml"===t.body.slice(0,5)){var r=require("xmldom").DOMParser,n=(new r).parseFromString(t.body);e.success(n)}else e.success(t.body);else"function"==typeof e.error&&e.error(t,t.statusCode,t.body)},function(t){"function"==typeof e.error&&e.error(t,"000",t)})}})},auth:function(e){return this.credentialOptions=e,this},proxy:function(e){return this.proxyweb=e,this},list:function(e,t){return this.reset(),t?("/"===t.substring(t.length-1,t.length)&&(t=t.substring(0,t.length-1)),this.url=t):this._getURL(),this.listID=e.replace(/&/g,"&amp;"),this},_getURL:function(e){var t=this;return t._promise(function(r){if(e=e!==!1,r||(r=function(){t.needQueue=!1}),"undefined"==typeof t.url)if("undefined"!=typeof _SP_BASEURL)t.url=_SP_BASEURL;else if("undefined"!=typeof L_Menu_BaseUrl)t.url=_SP_BASEURL=L_Menu_BaseUrl;else{if("undefined"==typeof _spPageContextInfo||"undefined"==typeof _spPageContextInfo.webServerRelativeUrl){t.needQueue=!0;var n=t._buildBodyForSOAP("WebUrlFromPageUrl","<pageUrl>"+window.location.href.replace(/&/g,"&amp;")+"</pageUrl>"),o="/_vti_bin/Webs.asmx";return void t.ajax({method:"POST",cache:!1,url:o,data:n,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var n=e.getElementsByTagName("WebUrlFromPageUrlResult");n.length&&(t.url=_SP_BASEURL=n[0].firstChild.nodeValue.toLowerCase()),r()}})}t.url=_SP_BASEURL=_spPageContextInfo.webServerRelativeUrl}r()})},getURL:function(){return"undefined"!=typeof _SP_BASEURL?_SP_BASEURL:(this._getURL(!1),this.url)},_buildBodyForSOAP:function(e,t,r){return r=r||"http://schemas.microsoft.com/sharepoint/soap/",'<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><'+e+' xmlns="'+r+'">'+t+"</"+e+"></soap:Body></soap:Envelope>"},webService:function(e){var t=this;return t._promise(function(r,n){var o,i="";if(!e.service)throw"Error 'webService': you have to provide the 'service'";if(!e.operation)throw"Error 'webService': you have to provide the 'operation'";if(e.webURL=e.webURL||t.url,!e.webURL)return void(t.hasPromise?t._getURL().then(function(){t.webService(e).then(function(e){r(e)},function(e){n(e)})}):(t._getURL(),t._addInQueue(arguments)));var a=!1;"function"==typeof e.after?a=!0:e.after=function(){},e.properties=e.properties||{};for(o in e.properties)e.properties.hasOwnProperty(o)&&(i+="<"+o+">"+e.properties[o]+"</"+o+">");e.soapURL=e.soapURL||"http://schemas.microsoft.com/sharepoint/soap/",i=t._buildBodyForSOAP(e.operation,i,e.soapURL),t.ajax({method:"POST",url:e.webURL+"/_vti_bin/"+e.service+".asmx",data:i,beforeSend:function(t){t.setRequestHeader("SOAPAction",e.soapURL+e.operation)},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(t){a?e.after(t):r(t)},error:function(t,r,o){a?e.after(t):n([t.responseText,r,o])}})})},_addInQueue:function(e){return this.listQueue.push(e),1===this.listQueue.length&&this._testQueue(),this},_testQueue:function(){var e=this;if(e.needQueue)setTimeout(function(){e._testQueue.call(e)},25);else{if(e.listQueue.length>0){var t=e.listQueue.shift();t.callee.apply(e,Array.prototype.slice.call(t))}e.needQueue=e.listQueue.length>0,e.needQueue&&setTimeout(function(){e._testQueue.call(e)},25)}},parse:function(e,t){var r=e.replace(/(\s+)?(=|~=|<=|>=|<>|<|>| LIKE | IN )(\s+)?/g,"$2").replace(/""|''/g,"Null").replace(/==/g,"="),n=[];t=t!==!1;for(var o=e.length,i="",a="",s=!1,l="",u={open:0},c=!1,d=0;d<r.length;d++){var f=r.charAt(d);switch(f){case"(":for(var h=d,p=!1;"("==r.charAt(d)&&o>d;)d++,u.open++;for(;u.open>0&&o>d;){d++;var m=r.charAt(d);"\\"==m?s=!0:s||"'"!=m&&'"'!=m?s||")"!=m||p?s=!1:u.open--:p=!p}var g=n.length-1;g>=0?(""!=i&&(n[0]="<"+i+">"+n[0]),n[0]+=this.parse(r.substring(h+1,d)),""!=i&&(n[0]+="</"+i+">"),i=""):n[0]=this.parse(r.substring(h+1,d));break;case"[":for(var h=d,p=!1;o>d;){d++;var m=r.charAt(d);if("\\"==m)s=!0;else if(s||"'"!=m&&'"'!=m){if(!s&&!p&&"]"==m)break;s=!1}else p=!p}var g=n.length-1,y=JSON.parse("["+r.substring(h+1,d)+"]"),S="Text";switch(typeof y[0]){case"number":S="Number";break;default:"~"===y[0].charAt(0)&&"number"==typeof(1*y[0].slice(1))&&(S="Integer",SPArrayForEach(y,function(e,t){y[t]=e.slice(1)}))}n[g]+='<FieldRef Name="'+l+'" '+("Integer"===S?'LookupId="True"':"")+' /><Values><Value Type="'+S+'">'+y.join('</Value><Value Type="'+S+'">')+"</Value></Values>"+a,l="",a="",g>0&&(""!=i&&(n[0]="<"+i+">"+n[0]),n[0]+=n[g],""!=i&&(n[0]+="</"+i+">"),delete n[g],i="");break;case">":case"<":d++,"="==r.charAt(d)?(n.push("<"+(">"==f?"G":"L")+"eq>"),a="</"+(">"==f?"G":"L")+"eq>"):"<"==f&&">"==r.charAt(d)?(n.push("<Neq>"),a="</Neq>"):(d--,n.push("<"+(">"==f?"G":"L")+"t>"),a="</"+(">"==f?"G":"L")+"t>");break;case"~":"="==r.charAt(d+1)&&(c=!0);break;case"=":n.push("<Eq>"),a="</Eq>";break;case" ":" AND "==r.substring(d,d+5).toUpperCase()?(i="And",d+=4):" OR "==r.substring(d,d+4).toUpperCase()?(i="Or",d+=3):" LIKE "==r.slice(d,d+6).toUpperCase()?(d+=5,n.push("<Contains>"),a="</Contains>"):" IN "==r.slice(d,d+4).toUpperCase()?(d+=3,n.push("<In>"),a="</In>"):l+=f;break;case'"':case"'":for(var _=f,v="",b="";(f=r.charAt(++d))!=_&&o>d;)"\\"==f&&(f=r.charAt(++d)),v+=f;g=n.length-1,n[g]+='<FieldRef Name="'+l+'" '+("[Me]"==v?'LookupId="True" ':"")+"/>",l="";var w="Text";/\d{4}-\d\d?-\d\d?((T| )\d{2}:\d{2}:\d{2})?/.test(v)&&(w="DateTime",/\d{4}-\d\d?-\d\d?((T| )\d{2}:\d{2}:\d{2})/.test(v)&&(b=' IncludeTimeValue="TRUE"')),t&&(v=this._cleanString(v)),"[Me]"===v?(v='<UserID Type="Integer" />',w="Integer"):"[Today"==v.slice(0,6)&&(w="DateTime",v='<Today OffsetDays="'+1*v.slice(6,-1)+'" />'),n[g]+='<Value Type="'+w+'"'+b+">"+v+"</Value>",n[g]+=a,a="",g>0&&(""!=i&&(n[0]="<"+i+">"+n[0]),n[0]+=n[g],""!=i&&(n[0]+="</"+i+">"),delete n[g],i="");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(""!=a){for(var A=f;!isNaN(f=r.charAt(++d))&&o>d;)A+=""+f;g=n.length-1,n[g]+='<FieldRef Name="'+l+'"'+(c?' LookupId="True"':"")+" />",l="",n[g]+='<Value Type="'+(c?"Integer":"Number")+'">'+A.replace(/ $/,"")+"</Value>",n[g]+=a,a="",g>0&&(""!=i&&(n[0]="<"+i+">"+n[0]),n[0]+=n[g],""!=i&&(n[0]+="</"+i+">"),delete n[g],i=""),d-=2;break}default:""==a?l+=f:"n"==f.toLowerCase()&&"null"==r.substring(d,d+4).toLowerCase()?(g=n.length-1,"</Neq>"==a?(n[g]="<IsNotNull>",a="</IsNotNull>"):"</Eq>"==a&&(n[g]="<IsNull>",a="</IsNull>"),d+=3,n[g]+='<FieldRef Name="'+l+'" />',l="",n[g]+=a,a="",g>0&&(""!=i&&(n[0]="<"+i+">"+n[0]),n[0]+=n[g],""!=i&&(n[0]+="</"+i+">"),delete n[g],i="")):("t"===f.toLowerCase()&&"true"===r.substring(d,d+4).toLowerCase()||"f"===f.toLowerCase()&&"false"===r.substring(d,d+5).toLowerCase())&&(g=n.length-1,d+=3,"f"===f.toLowerCase()&&d++,n[g]+='<FieldRef Name="'+l+'" /><Value Type="Boolean">'+("t"===f.toLowerCase()?1:0)+"</Value>",l="",n[g]+=a,a="",g>0&&(""!=i&&(n[0]="<"+i+">"+n[0]),n[0]+=n[g],""!=i&&(n[0]+="</"+i+">"),delete n[g],i=""))}}return n.join("")},_parseOn:function(e){for(var t=[],r=e.replace(/(\s+)?(=)(\s+)?/g,"$2").replace(/==/g,"=").split(" AND "),n=0;n<r.length;n++){var o=r[n].match(/'([^']+)'\.([a-zA-Z0-9_]+)='([^']+)'\.([a-zA-Z0-9_]+)/);if(o&&5==o.length){var i={};i[o[1]]=o[2],i[o[3]]=o[4],t.push(i)}}return t},_cleanString:function(e){return e.replace(/&(?!amp;|lt;|gt;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},cleanResult:function(e,t){return null===e||"undefined"==typeof e?"":(t=t||";","string"==typeof e?e.replace(/^(string;|float;)#?/,"").replace(/;#[0-9]+;#/g,t).replace(/^[0-9]+;#/,"").replace(/^;#|;#$/g,"").replace(/;#/g,t):e)},_promise:function(e){if("function"!=typeof Promise){if("function"==typeof jQuery){var t=jQuery.Deferred();return e(function(){t.resolve.apply(this,arguments)},function(){t.reject.apply(this,arguments)}),t}return e.call(this),this}return new Promise(e)},then:function(){throw"[SharepointPlus] You tried to use `then()` however your browser doesn't support Promise, and you don't use jQuery. Please refer to the documentation."},get:function(e,t){var r=this;return r._promise(function(n,o){if(r.needQueue)return r._addInQueue(arguments);if(r.listID==undefined)throw"Error 'get': you have to define the list ID/Name";1===arguments.length&&"function"==typeof e&&(t=e,e={});var i=!1;t&&(n=t,o=function(e){t([],e)},i=!0),n||(n=o=function(){});var a={};if(SPExtend(!0,a,e),r.url==undefined)throw"Error 'get': not able to find the URL!";if(a.fields=a.fields||"",a.where=a.where||"",a.whereFct=a.whereFct||function(e){return e},a.orderby=a.orderby||"",a.useIndexForOrderBy=a.useIndexForOrderBy===!0,a.groupby=a.groupby||"",a.rowlimit=a.rowlimit||0,a.whereEscapeChar=a.whereEscapeChar!==!1,a.paging=a.paging===!0,a.page=a.paging===!1||isNaN(a.page)?5e3:a.page,a.paging&&0===a.rowlimit&&(a.rowlimit=5e3),a.expandUserField=a.expandUserField===!0||"True"===a.expandUserField?"True":"False",a.dateInUTC=a.dateInUTC===!0?"True":"False",a.folderOptions=a.folderOptions||null,a.view=a.view||"",a.calendar=a.calendar===!0,a.calendar===!0&&(a.calendarOptions=a.calendarOptions||{},a.calendarOptions.referenceDate=a.calendarOptions.referenceDate||new Date,"string"!=typeof a.calendarOptions.referenceDate&&(a.calendarOptions.referenceDate=r.toSPDate(a.calendarOptions.referenceDate)),a.calendarOptions.splitRecurrence=a.calendarOptions.splitRecurrence===!1?"FALSE":"TRUE",a.calendarOptions.range=a.calendarOptions.range||"Month"),a.results=a.results||[],a.listItemCollectionPositionNext=a.listItemCollectionPositionNext||"",a.listItemCollectionPositionNext&&(a.listItemCollectionPositionNext=a.listItemCollectionPositionNext.replace(/&/g,"&amp;").replace(/&amp;amp;/g,"&amp;")),"object"==typeof a.where?(a.where=a.where.slice(0),a.originalWhere==undefined&&(a.originalWhere=a.where.slice(0)),a.nextWhere=a.where.slice(1),a.where=a.where.shift()):(a.originalWhere=a.where,a.nextWhere=[]),a.progress=a.progress||function(){},""!==a.view)return void r.view(a.view,function(e,s){a.view=s;var l=a.whereCAML?a.where:r.parse(a.where),u=e.whereCAML.match(/^<And>(<DateRangesOverlap>.*<\/DateRangesOverlap>)(.*)<\/And>$/);u&&3===u.length&&(e.whereCAML="<And>"+u[2]+u[1]+"</And>"),l+=e.whereCAML,""!==a.where&&""!==e.whereCAML&&(l="<And>"+l+"</And>"),a.where=l,a.fields+=(""===a.fields?"":",")+e.fields.join(","),a.orderby+=(""===a.orderby?"":",")+e.orderby,a.whereCAML=!0,a.useOWS=!0,a.calendarViaView=a.calendar,a.calendar=!1,delete a.view,i?r.get(a,t):r.get(a).then(function(e){n(e)},function(e){o(e)})});var s=!0,l="";if(""==a.fields||a.fields==[])l="";else{"string"==typeof a.fields&&(a.fields=a.fields.replace(/^\s+/,"").replace(/\s+$/,"").replace(/( )?,( )?/g,",").split(","));for(var u=0;u<a.fields.length;u++)l+='<FieldRef Name="'+a.fields[u]+'" />'}var c="";if(""!=a.orderby){var d=a.orderby.split(",");for(u=0;u<d.length;u++){var f="ASC",h=d[u].trim().split(" ");h.length>0&&(2==h.length&&(f=h[1].toUpperCase()),c+=s?'<FieldRef Name="'+h[0]+'" Ascending="'+("ASC"==f)+'" />':'<OrderField Name="'+h[0]+'" Direction="'+f+'" />')}}a.calendar!==!0&&a.calendarViaView!==!0||""!==c||(c='<FieldRef Name="EventDate" Ascending="ASC" />');var p="";if(""!=a.groupby){var m=a.groupby.split(",");for(u=0;u<m.length;u++)p+='<FieldRef Name="'+m[u]+'" />'}if(a.calendar===!0||a.calendarViaView===!0){var g=["Title","EventDate","EndDate","Duration","fAllDayEvent","fRecurrence","RecurrenceData","ID"];for(u=0;u<g.length;u++)l+='<FieldRef Name="'+g[u]+'" />'}var y="";if(a.queryOptions===undefined)if(a._queryOptions="<DateInUtc>"+a.dateInUTC+'</DateInUtc><Paging ListItemCollectionPositionNext="'+a.listItemCollectionPositionNext+'"></Paging><IncludeAttachmentUrls>True</IncludeAttachmentUrls>'+(""===l?"":"<IncludeMandatoryColumns>False</IncludeMandatoryColumns>")+"<ExpandUserField>"+a.expandUserField+"</ExpandUserField>",a.folderOptions){var S;switch(a.folderOptions.show){case"FilesAndFolders_Recursive":S="RecursiveAll";break;case"FilesOnly_InFolder":S="FilesOnly";break;case"FilesAndFolders_InFolder":S="";break;case"FilesOnly_Recursive":default:S="Recursive"}a._queryOptions+='<ViewAttributes Scope="'+S+'"></ViewAttributes>',a.folderOptions.path&&(a._queryOptions+="<Folder>"+r.url+"/"+r.listID+"/"+a.folderOptions.path+"</Folder>")}else a._queryOptions+='<ViewAttributes Scope="Recursive"></ViewAttributes>';else a._queryOptions=a.queryOptions;a.calendarOptions&&(a._queryOptions+="<CalendarDate>"+a.calendarOptions.referenceDate+"</CalendarDate><RecurrencePatternXMLVersion>v3</RecurrencePatternXMLVersion><ExpandRecurrence>"+a.calendarOptions.splitRecurrence+"</ExpandRecurrence>");var _="";if(""!==a.where&&(_=a.whereCAML?a.where:r.parse(a.where)),a.calendar===!0){var v="<DateRangesOverlap><FieldRef Name='EventDate' /><FieldRef Name='EndDate' /><FieldRef Name='RecurrenceID' /><Value Type='DateTime'><"+a.calendarOptions.range+" /></Value></DateRangesOverlap>";_=""!==_?"<And>"+_+v+"</And>":v}if(_=a.whereFct(_),s){y="<listName>"+r.listID+"</listName><viewName>"+(a.viewID||"")+"</viewName><query><Query>"+(""!=_?"<Where>"+_+"</Where>":"")+(""!=p?"<GroupBy>"+p+"</GroupBy>":"")+(""!=c?"<OrderBy"+(a.useIndexForOrderBy?" UseIndexForOrderBy='TRUE' Override='TRUE'":"")+">"+c+"</OrderBy>":"")+"</Query></query><viewFields><ViewFields Properties='True'>"+l+"</ViewFields></viewFields><rowLimit>"+a.rowlimit+"</rowLimit><queryOptions><QueryOptions>"+a._queryOptions+"</QueryOptions></queryOptions>",y=r._buildBodyForSOAP("GetListItems",y);var b=r.url+"/_vti_bin/Lists.asmx";r.ajax({method:"POST",cache:!1,url:b,data:y,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var s,l,u,c,d,f,h,p,m,g,y,S,_,v,b,w,A,E,P,I,T,D,C,x,O;if(s=e.getElementsByTagName("z:row"),0==s.length&&(s=e.getElementsByTagName("row")),O=fastMap(s,function(e){return myElem(e)}),a.results.length>0)for(l=0,c=O.length;c>l;l++)a.results.push(O[l]);if("string"!=typeof a.originalWhere&&a.progress(a.originalWhere.length-a.nextWhere.length,a.originalWhere.length),a.paging&&(d=e.getElementsByTagName("rs:data")[0],"undefined"!=typeof d&&0!=d.length||(d=e.getElementsByTagName("data")[0]),d&&(y=d.getAttribute("ListItemCollectionPositionNext"))),a.paging&&--a.page>0){if(0===a.results.length&&(a.results=O),a.progress(a.results.length),y)return a.listItemCollectionPositionNext=r._cleanString(y),void(i?r.get(a,t):r.get(a).then(function(e){n(e)},function(e){o(e)}));O=a.results}else{if(a.nextWhere.length>0)return 0===a.results.length&&(a.results=O),a.where=a.nextWhere.slice(0),void(i?r.get(a,t):r.get(a).then(function(e){n(e)},function(e){o(e)}));a.where=a.originalWhere,O=a.results.length>0?a.results:O}if(a.joinData){for(f=a.joinData.noindex,h=[],p="",g={length:0},f.length||alert("$SP.get() -- Error 'get': you must define the ON clause when JOIN is used."),l=0,c=O.length;c>l;l++){for(m="",u=0;u<f.length;u++)m+="_"+r.getLookup(O[l].getAttribute(f[u][r.listID])).id;if(a.joinData[m])for(p!==m&&(g[a.joinIndex[m]]||g.length++,g[a.joinIndex[m]]=!0,p=m),u=0,S=a.joinData[m].length;S>u;u++){for(_=[],b=O[l].getAttributes(),w=b.length;w--;)_[r.listID+"."+b[w].nodeName.slice(4)]=b[w].nodeValue;A=a.joinData[m][u].getAttributes();for(w in A)_[w]=a.joinData[m][u].getAttribute(w);h.push(new extendMyObject(_))}a.innerjoin&&(a.join=a.innerjoin),a.outerjoin&&(a.join=a.outerjoin,a.join.outer=!0)}if(O=h,a.where&&a.where!==a.onLookupWhere&&a.outer&&(a.outer=!1),a.outer&&(E=a.joinIndex.length,g.length<E))for(l=0;E>l;l++)if(g[l]!==!0){if(P=a.joinIndex[l],P===undefined||a.joinData[P]===undefined)continue;for(u=0,S=a.joinData[P].length;S>u;u++){_=[],A=a.joinData[P][u].getAttributes();for(w in A)_[w]=a.joinData[P][u].getAttribute(w);h.push(new extendMyObject(_))}}}if(a.outerjoin?(a.join=a.outerjoin,a.join.outer=!0):a.innerjoin&&(a.join=a.innerjoin),a.join){for(T=[],D=[],C=[],a.join.onLookup&&(a.join.on="'"+a.join.list+"'."+a.join.onLookup+" = '"+r.listID+"'.ID"),f=r._parseOn(a.join.on),T.noindex=f,l=0,c=O.length;c>l;l++){for(m="",_=[],u=0;u<f.length;u++)m+="_"+r.getLookup(O[l].getAttribute(f[u][r.listID])||O[l].getAttribute(r.listID+"."+f[u][r.listID])).id;if(T[m]||(D[m]=D.length,D.push(m),T[m]=[],a.join.onLookup&&"_"!==m&&C.push("~"+m.slice(1))),a.joinData)T[m].push(O[l]);else{for(v=O[l].getAttributes(),u=v.length;u--;)_[r.listID+"."+v[u].nodeName.slice(4)]=v[u].nodeValue;T[m].push(new extendMyObject(_))}}if(delete a.joinData,a.join.onLookup){if(C.length>0){for(x=SPArrayChunk(C,60),u=0;u<x.length;u++)x[u]=a.join.onLookup+' IN ["'+x[u].join('","')+'"]';x.length<=_SP_MAXWHERE_ONLOOKUP?(x="("+x.join(" OR ")+")",a.join.where?SPIsArray(a.join.where)?SPArrayForEach(a.join.where,function(e,t){a.join.where[t]=x+" AND ("+e+")"}):a.join.where=x+" AND ("+a.join.where+")":a.join.where=x,a.join.onLookupWhere=x):a.join.paging=!0}a.join.fields||(a.join.fields=[]),SPIsArray(a.join.fields)?a.join.fields.push(a.join.onLookup):(_=a.join.fields.split(","),_.push(a.join.onLookup),a.join.fields=_.join(","))}return I=r.list(a.join.list,a.join.url||r.url),a.join.joinData=T,a.join.joinIndex=D,void(i?I.get(a.join,t):I.get(a.join).then(function(e){n(e)},function(e){o(e)}))}O.NextPage=y,n(O,y)},error:function(e,t,r){if("000"!==t){var n=e.responseXML,i=n?n.getElementsByTagName("errorstring"):null;o(i&&i[0]?"Error: "+i[0].firstChild.nodeValue:t+": "+r)}else o(r)}})}})},createFile:function(e){var t=this;return t._promise(function(r,n){if(e=e||{},e.content===undefined)throw"Error 'createFile': not able to find the file content.";if(e.filename===undefined)throw"Error 'createFile': not able to find the filename.";if(e.library===undefined){if(t.listID===undefined)throw"Error 'createFile': not able to find the library name.";e.library=t.listID}return e.url=e.url||t.url,t.url=e.url,t.listID=e.library,e.url?(e.after=e.after||function(){},e.success=e.success||function(){},e.error=e.error||function(){},e.encoded=e.encoded===!0,e.extendedFields=e.extendedFields||"",e.encoded&&"[object ArrayBuffer]"!==Object.prototype.toString.call(e.content)&&(e.encoded=!1,e.content=t.decode_b64(e.content)),void t.hasREST({callback:function(o){if(o&&e.encoded)t.info(function(o){var i=o._List.RootFolder,a=e.filename.split("/"),s=e.filename;a.length>1?(s=a.slice(-1),a="/"+a.slice(0,-1).join("/")):a="",a=i+a,t.ajax({url:t.url+"/_api/web/GetFolderByServerRelativeUrl('"+encodeURIComponent(a)+"')/files/add(url='"+encodeURIComponent(s)+"',overwrite=true)",type:"POST",data:e.content,onprogress:function(t){if(t.lengthComputable){var r=t.loaded/t.total;e.progress(parseInt(100*r))}},success:function(n){e.fields?t.ajax({url:n.d.ListItemAllFields.__deferred.uri,method:"GET",success:function(n){var o=n.d,i=SPExtend({ID:o.ID},e.fields);t.update(i,{after:function(){r(t.url+a+s)}})},error:function(){r(t.url+a+s)}}):r(t.url+a+s)},error:function(e){n(e)}})});else{if(e.fields&&!e.extendedFields){if("object"!=typeof e.fields)throw"Error 'createFile': please refer to the documentation regarding `fields`";return void t.list(e.library,e.url).info(function(o){for(var i=o.length;i--;)e.fields[o[i].StaticName]&&(e.extendedFields+='<FieldInformation Type="'+o[i].Type+'" Value="'+e.fields[o[i].StaticName]+'" DisplayName="'+o[i].StaticName+'" InternalName="'+o[i].StaticName+'" />');e.extendedFields||delete e.fields,e.useCallback?t.createFile(e):t.createFile(e).then(function(e){r(e)},function(e){n(e)})})}var i="/"+e.library+"/"+e.filename;i=(e.url+i).replace(/([^:]\/)\//g,"$1"),"http"!==i.slice(0,4)&&(i=window.location.protocol+"//"+window.location.host+i);var a=e.content;e.encoded?"[object ArrayBuffer]"===Object.prototype.toString.call(a)&&(a=SPArrayBufferToBase64(a)):a=t.encode_b64(a);var s="<SourceUrl>http://null</SourceUrl><DestinationUrls><string>"+i+'</string></DestinationUrls><Fields><FieldInformation Type="File" />'+e.extendedFields+"</Fields><Stream>"+a+"</Stream>";s=t._buildBodyForSOAP("CopyIntoItems",s),t.ajax({url:e.url+"/_vti_bin/copy.asmx",method:"POST",dataType:"xml",data:s,onprogress:function(t){if(t.lengthComputable){var r=t.loaded/t.total;e.progress(parseInt(100*r))}},beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CopyIntoItems")},contentType:'text/xml; charset="utf-8"',success:function(o){var a,s=o.getElementsByTagName("CopyResult");s&&s[0]&&"Success"!==s[0].getAttribute("ErrorCode")?(a="Error 'createFile' ("+i+"): "+s[0].getAttribute("ErrorCode")+" - "+s[0].getAttribute("ErrorMessage"),e.error.call(t,i,a),n(a)):(e.success.call(t,i),r(i)),e.useCallback&&e.after.call(t,i,a)},error:function(r,o,a){e.error.call(t,i,a),e.useCallback?e.after.call(t,i,a):n(a)}})}}})):void(t.hasPromise?t._getURL().then(function(){t.createFile(e).then(function(e){r(e)},function(e){n(e)})}):(t._getURL(),t._addInQueue(arguments)))})},createFolder:function(e){var t=this;return t._promise(function(r){if(e=e||{},"string"==typeof e&&(e={path:e}),e.path==undefined)throw"Error 'createFolder': please provide the 'path'.";if(e.library===undefined){if(t.listID===undefined)throw"Error 'createFolder': not able to find the library name.";e.library=t.listID}var n=!1;if("function"==typeof e.after?n=!0:e.after=function(){},e.url=e.url||t.url,!e.url)return void(t.hasPromise?t._getURL().then(function(){t.createFolder(e).then(function(e){r(e)})}):(t._getURL(),t._addInQueue(arguments)));var o=e.path,i=[],a="";"/"===o.charAt(0)&&(o=o.slice(1)),"/"===o.slice(-1)&&(o=o.slice(0,-1)),o=o.split("/");for(var s=0;s<o.length;s++)a+=(s>0?"/":"")+o[s],i.push({FSObjType:1,BaseName:a});n?t.list(e.library,e.url).add(i,{after:function(t,r){e.after(t,r)}}):t.list(e.library,e.url).add(i).then(function(e){var t=[];SPArrayForEach(e,function(e){SPArrayForEach(e,function(e){SPIsArray(e)?t=t.concat(e):t.push(e)})}),r(t)})})},checkin:function(e){var t=this;return t._promise(function(r,n){if(e=e||{},e.destination==undefined)throw"Error 'checkin': not able to find the file destination path.";if(e.url=e.url||t.url,!e.url)return void(t.hasPromise?t._getURL().then(function(){t.checkin(e).then(function(e){r(e)})}):(t._getURL(),t._addInQueue(arguments)));if(t.url==undefined)throw"Error 'checkin': not able to find the URL!";e.url=t.url,e.comments=e.comments||"",e.success=e.success||function(){},e.error=e.error||function(){},e.after=e.after||function(){};var o=t._buildBodyForSOAP("CheckInFile","<pageUrl>"+e.destination+"</pageUrl><comment>"+e.comments+"</comment><CheckinType>1</CheckinType>");t.ajax({url:e.url+"/_vti_bin/Lists.asmx",method:"POST",dataType:"xml",data:o,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CheckInFile")},contentType:"text/xml; charset=utf-8",success:function(o){var i=o.getElementsByTagName("CheckInFileResult");i&&i[0]&&"true"!=i[0].firstChild.nodeValue?(e.error.call(t),n()):(e.success.call(t),r()),e.after.call(t)}})})},addAttachment:function(e){if(this.needQueue)return this._addInQueue(arguments);if(0===arguments.length)throw"Error 'addAttachment': the arguments are mandatory";if(this.listID===undefined)throw"Error 'addAttachment': you need to use list() to define the list name.";if("undefined"==typeof e.ID)throw"Error 'addAttachment': the item ID is mandatory";if("undefined"==typeof e.filename)throw"Error 'addAttachment': the filename is mandatory";if("undefined"==typeof e.attachment)throw"Error 'addAttachment': the base64-encoded attachment is mandatory";e.after=e.after||function(){};var t=this,r=t._buildBodyForSOAP("AddAttachment","<listName>"+this.listID+"</listName><listItemID>"+e.ID+"</listItemID><fileName>"+e.filename+"</fileName><attachment>"+e.attachment+"</attachment>");t.ajax({url:t.url+"/_vti_bin/Lists.asmx",method:"POST",dataType:"xml",data:r,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/AddAttachment")},contentType:"text/xml; charset=utf-8",
 success:function(r){var n=r.getElementsByTagName("AddAttachmentResult"),o="";n&&n[0]&&(o=t.getURL()+"/"+n[0].firstChild.nodeValue),e.after.call(t,o)}})},getAttachment:function(e,t,r){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'getAttachment': you have to define the list ID/Name";if(1===arguments.length&&"function"==typeof e)throw"Error 'getAttachment': you have to define the item ID";if(this.url==undefined)throw"Error 'getAttachment': not able to find the URL!";"object"!=typeof e&&(e=e.split(",")),r=r||[];var n=this,o=n._buildBodyForSOAP("GetAttachmentCollection","<listName>"+this.listID+"</listName><listItemID>"+e.shift()+"</listItemID>"),i=this.url+"/_vti_bin/lists.asmx",a=[];return n.ajax({method:"POST",cache:!1,url:i,data:o,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetAttachmentCollection")},dataType:"xml",success:function(o){for(var i=o.getElementsByTagName("Attachment"),s=0;s<i.length;s++)a.push(i[s].firstChild.nodeValue);0===a.length?a="":1===a.length&&(a=a[0]),r.push(a),0===e.length?"function"==typeof t&&t.call(n,r):n.getAttachment(e,t,r)}}),this},getContentTypes:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'getContentTypes': you have to define the list ID";if(1===arguments.length&&"function"==typeof e)return this.getContentTypes(null,e);if(this.url==undefined)throw"Error 'getContentTypes': not able to find the URL!";if(e||(e={cache:!0}),e.cache)for(var r=0;r<_SP_CACHE_CONTENTTYPES.length;r++)if(_SP_CACHE_CONTENTTYPES[r].list===this.listID&&_SP_CACHE_CONTENTTYPES[r].url===this.url)return"function"==typeof t&&t.call(this,_SP_CACHE_CONTENTTYPES[r].contentTypes),this;var n=this,o=n._buildBodyForSOAP("GetListContentTypes","<listName>"+n.listID+"</listName>"),i=this.url+"/_vti_bin/lists.asmx",a=[];return n.ajax({method:"POST",cache:!1,url:i,data:o,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetListContentTypes")},dataType:"xml",success:function(e){for(var r,o=e.getElementsByTagName("ContentType"),i=0;i<o.length;i++)r=o[i].getAttribute("ID"),r&&a.push({ID:r,Name:o[i].getAttribute("Name"),Description:o[i].getAttribute("Description")});_SP_CACHE_CONTENTTYPES.push({list:n.listID,url:n.url,contentTypes:a}),"function"==typeof t&&t.call(n,a)}}),this},getContentTypeInfo:function(e,t,r){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'getContentTypeInfo': you have to define the list ID";if(arguments.length>=1&&"string"!=typeof e)throw"Error 'getContentTypeInfo': you have to provide the Content Type Name/ID";if(2===arguments.length&&"function"==typeof t)return this.getContentTypeInfo(e,null,t);if(this.url==undefined)throw"Error 'getContentTypeInfo': not able to find the URL!";if(t||(t={cache:!0}),t.cache)for(var n=0;n<_SP_CACHE_CONTENTTYPE.length;n++)if(_SP_CACHE_CONTENTTYPE[n].list===this.listID&&_SP_CACHE_CONTENTTYPE[n].url===this.url&&_SP_CACHE_CONTENTTYPE[n].contentType===e)return"function"==typeof r&&r.call(this,_SP_CACHE_CONTENTTYPE[n].info),this;if("0x"!==e.slice(0,2))return this.getContentTypes(t,function(n){for(var o=!1,i=n.length;i--;)if(n[i].Name===e){this.getContentTypeInfo(n[i].ID,t,r),o=!0;break}if(!o)throw"Error 'getContentTypeInfo': not able to find the Content Type called '"+e+"' at "+this.url}),this;var o=this,i=o._buildBodyForSOAP("GetListContentType","<listName>"+o.listID+"</listName><contentTypeId>"+e+"</contentTypeId>"),a=this.url+"/_vti_bin/lists.asmx",s=[];return o.ajax({method:"POST",cache:!1,url:a,data:i,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetListContentType")},dataType:"xml",success:function(t){for(var n,i,a,l,u,c,d=t.getElementsByTagName("Field"),f=0,h=0;h<d.length;h++)if(d[h].getAttribute("ID")){s[f]=[],n=s[f],i=d[h].attributes;for(var p=i.length;p--;){if(a=i[p].nodeName,u=i[p].nodeValue,"Type"===a)switch(u){case"Choice":case"MultiChoice":n.FillInChoice=d[h].getAttribute("FillInChoice");for(var m=d[h].getElementsByTagName("CHOICE"),g=[],y=0;y<m.length;y++)g.push(m[y].firstChild.nodeValue);n.Choices=g;break;case"Lookup":case"LookupMulti":n.Choices={list:d[h].getAttribute("List"),field:d[h].getAttribute("ShowField")};break;default:n.Choices=[]}n[a]=u}if(l=d[h].getElementsByTagName("Default").length,l>0){c=d[h].getElementsByTagName("Default"),s[f].DefaultValue=[];for(var S=0;l>S;S++)c[S].firstChild&&s[f].DefaultValue.push(c[S].firstChild.nodeValue);1===l&&(s[f].DefaultValue=s[f].DefaultValue[0])}else s[f].DefaultValue=null;f++}_SP_CACHE_CONTENTTYPE.push({list:o.listID,url:o.url,contentType:e,info:s}),"function"==typeof r&&r.call(o,s)}}),this},info:function(e){var t=this;return t._promise(function(r,n){if(t.needQueue)return t._addInQueue(arguments);if(t.listID==undefined)throw"Error 'info': you have to define the list ID";var o=!1;if("function"==typeof e&&(r=e,n=function(t){e([],t)},o=!0),r||(r=n=function(){}),t.url==undefined)throw"Error 'info': not able to find the URL!";var i=t._buildBodyForSOAP("GetList","<listName>"+t.listID+"</listName>"),a=[];t.ajax({method:"POST",url:t.url+"/_vti_bin/lists.asmx",data:i,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetList")},success:function(e){var t,n,o,i,s,l,u,c,d,f,h,p,m,g=e.getElementsByTagName("Field"),y=0,S=e.getElementsByTagName("List")[0];for(n=S.attributes,a._List={},u=0;u<n.length;u++)a._List[n[u].nodeName]=n[u].nodeValue;for(u=0;u<g.length;u++)if(g[u].getAttribute("ID")){for(a[y]=[],t=a[y],n=g[u].attributes,c=n.length;c--;){if(o=n[c].nodeName,i=n[c].nodeValue,"Type"===o)switch(i){case"Choice":case"MultiChoice":for(t.FillInChoice=g[u].getAttribute("FillInChoice"),d=g[u].getElementsByTagName("CHOICE"),f=[],h=0;h<d.length;h++)f.push(d[h].firstChild.nodeValue);t.Choices=f;break;case"Lookup":case"LookupMulti":t.Choices={list:g[u].getAttribute("List"),field:g[u].getAttribute("ShowField")};break;case"TaxonomyFieldType":case"TaxonomyFieldTypeMulti":for(d=g[u].getElementsByTagName("Property"),t.Property={},h=0;h<d.length;h++)p=d[h].getElementsByTagName("Name"),m=d[h].getElementsByTagName("Value"),p.length>0&&(t.Property[p[0].firstChild.nodeValue]=m.length>0?m[0].firstChild.nodeValue:null);break;default:t.Choices=[]}t[o]=i}if(s=g[u].getElementsByTagName("Default").length,s>0){l=g[u].getElementsByTagName("Default"),a[y].DefaultValue=[];for(var _=0;s>_;_++)l[_].firstChild&&a[y].DefaultValue.push(l[_].firstChild.nodeValue);1===s&&(a[y].DefaultValue=a[y].DefaultValue[0])}else a[y].DefaultValue=null;y++}r(a)},error:function(e,t,r){n(r)}})})},view:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'view': you have to define the list ID/Name";if(1===arguments.length&&"function"==typeof e)return this.view("",e);var r=this.listID;if(this.url==undefined)throw"Error 'view': not able to find the URL!";e=e||"";var n=arguments[2]||e;n=n.toLowerCase();for(var o=_SP_CACHE_SAVEDVIEW.length;o--;)if(_SP_CACHE_SAVEDVIEW[o].url===this.url&&_SP_CACHE_SAVEDVIEW[o].list===r&&(_SP_CACHE_SAVEDVIEW[o].viewID===e||_SP_CACHE_SAVEDVIEW[o].viewName===n))return t.call(this,_SP_CACHE_SAVEDVIEW[o].data,e),this;if("{"!==e.charAt(0))return this.views(function(r){for(var n=!1,o=r.length;o--;)if(r[o].Name===e){this.view(r[o].ID,t,e),n=!0;break}if(!n)throw"Error 'view': not able to find the view called '"+e+"' at "+this.url}),this;var i=this,a=i._buildBodyForSOAP("GetView","<listName>"+i.listID+"</listName><viewName>"+e+"</viewName>"),s=this.url+"/_vti_bin/Views.asmx",l=["fields","orderby","whereCAML"];return i.ajax({method:"POST",cache:!1,url:s,data:a,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetView")},dataType:"xml",success:function(o){l.fields=[];for(var a=o.getElementsByTagName("ViewFields")[0].getElementsByTagName("FieldRef"),s=0;s<a.length;s++)l.fields.push(a[s].getAttribute("Name"));if(l.orderby="",a=o.getElementsByTagName("OrderBy"),a.length){var u=[];for(a=a[0].getElementsByTagName("FieldRef"),s=0;s<a.length;s++)u.push(a[s].getAttribute("Name")+" "+(a[s].getAttribute("Ascending")==undefined?"ASC":"DESC"));l.orderby=u.join(",")}l.whereCAML="";var c=o.getElementsByTagName("Where");c.length&&(c=c[0].xml||(new XMLSerializer).serializeToString(c[0]),c=c.match(/<Where [^>]+>(.*)<\/Where>/),2==c.length&&(l.whereCAML=c[1])),_SP_CACHE_SAVEDVIEW.push({url:i.url,list:r,data:l,viewID:e,viewName:n}),"function"==typeof t&&t.call(i,l,e)}}),this},views:function(e,t){if("function"==typeof e)return this.views({},e);if(e.cache=e.cache!==!1,this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'views': you have to define the list ID";if(this.url==undefined)throw"Error 'views': not able to find the URL!";if(t=t||function(){},e.cache)for(var r=_SP_CACHE_SAVEDVIEWS.length;r--;)if(_SP_CACHE_SAVEDVIEWS[r].url==this.url&&_SP_CACHE_SAVEDVIEWS[r].listID===this.listID)return t.call(this,_SP_CACHE_SAVEDVIEWS[r].data),this;var n=this,o=n._buildBodyForSOAP("GetViewCollection","<listName>"+n.listID+"</listName>"),i=n.url+"/_vti_bin/Views.asmx",a=[];return n.ajax({method:"POST",cache:!1,url:i,data:o,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetViewCollection")},dataType:"xml",success:function(r){for(var o=r.getElementsByTagName("View"),i=0;i<o.length;i++)a[i]=[],a[i].ID=o[i].getAttribute("Name"),a[i].Name=o[i].getAttribute("DisplayName"),a[i].Url=o[i].getAttribute("Url"),a[i].Node=o[i];e.cache===!0&&_SP_CACHE_SAVEDVIEWS.push({url:n.url,listID:n.listID,data:a}),t.call(n,a)}}),this},lists:function(e,t){if(1===arguments.length&&"function"==typeof e)return this.lists({},e);if(e=e||{},e.url=e.url||this.url,!e.url)return this._getURL(),this._addInQueue(arguments);if(this.url=e.url,this.url==undefined)throw"Error 'lists': not able to find the URL!";var r=this,n=r._buildBodyForSOAP("GetListCollection",""),o=_SP_CACHE_SAVEDLISTS;if(o!=undefined){for(var i=o.length;i--;)if(o[i].url==this.url)return"function"==typeof t?t(o[i].data):(this.data=o[i].data,this.length=this.data.length),this}else o=[];var a=r.url+"/_vti_bin/lists.asmx",s=[];return r.ajax({method:"POST",cache:!1,url:a,data:n,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetListCollection")},dataType:"xml",success:function(e){for(var n=e.getElementsByTagName("List"),i=0;i<n.length;i++)s[i]=[],s[i].ID=n[i].getAttribute("ID"),s[i].Name=n[i].getAttribute("Title"),s[i].Url=n[i].getAttribute("DefaultViewUrl"),s[i].Description=n[i].getAttribute("Description");o.push({url:r.url,data:s}),_SP_CACHE_SAVEDLISTS=o,"function"==typeof t&&t.call(r,s)}}),this},add:function(e,t){var r=this;return r._promise(function(n){if(r.needQueue)return r._addInQueue(arguments);if(0===arguments.length||1===arguments.length&&"object"!=typeof e)throw"Error 'add': you need to define the list of items";if(r.listID===undefined)throw"Error 'add': you need to use list() to define the list name.";var o={};if(SPExtend(!0,o,t),r.url==undefined)throw"Error 'add': not able to find the URL!";o.useCallback===!1||"function"!=typeof o.after&&n?o.useCallback=!1:o.useCallback=!0,o.success=o.success||function(){},o.error=o.error||function(){},o.after=o.after||function(){},o.escapeChar=o.escapeChar==undefined?!0:o.escapeChar,o.progress=o.progress||function(){},o.packetsize=o.packetsize||15,"object"==typeof e&&e.length==undefined&&(e=[e]);var i=e.length;if(o.progressVar=o.progressVar||{current:0,max:i,passed:[],failed:[],eventID:"spAdd"+(""+Math.random()).slice(2)},i>o.packetsize){var a=e.slice(0),s=a.splice(0,o.packetsize);_SP_ADD_PROGRESSVAR[o.progressVar.eventID]=function(e){return r.add(a,e)},e=s,i=e.length}else if(0==i)return o.progress(1,1),o.error([]),o.success([]),void(o.useCallback?o.after([],[]):n([[],[]]));o.progressVar.current+=i;for(var l,u,c,d='<Batch OnError="Continue" ListVersion="1"  ViewName="">',f=0;f<e.length;f++){d+='<Method ID="'+(f+1)+'" Cmd="New">',d+="<Field Name='ID'>New</Field>";for(c in e[f])e[f].hasOwnProperty(c)&&(l=c,u=e[f][c],SPIsArray(u)&&(u=";#"+u.join(";#")+";#"),o.escapeChar&&"string"==typeof u&&(u=r._cleanString(u)),d+="<Field Name='"+l+"'>"+u+"</Field>");d+="</Method>"}d+="</Batch>";var h=r._buildBodyForSOAP("UpdateListItems","<listName>"+r.listID+"</listName><updates>"+d+"</updates>"),p=r.url+"/_vti_bin/lists.asmx";r.ajax({method:"POST",cache:!1,url:p,data:h,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(t){for(var i=t.getElementsByTagName("Result"),a=i.length,s=o.progressVar.passed,l=o.progressVar.failed,u=0;a>u;u++)if("0x00000000"==i[u].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue){var c=i[u].getElementsByTagName("z:row");0==c.length&&(c=i[u].getElementsByTagName("row")),e[u]&&(e[u].ID=c[0].getAttribute("ows_ID"),s.push(e[u]))}else e[u]&&(e[u].errorMessage=i[u].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,l.push(e[u]));o.progress(o.progressVar.current,o.progressVar.max),o.progressVar.current<o.progressVar.max?_SP_ADD_PROGRESSVAR[o.progressVar.eventID]&&(o.useCallback?_SP_ADD_PROGRESSVAR[o.progressVar.eventID](o):_SP_ADD_PROGRESSVAR[o.progressVar.eventID](o).then(function(e){n(e)})):(l.length>0&&o.error.call(r,l),s.length>0&&o.success.call(r,s),o.useCallback?o.after.call(r,s,l):n([s,l]),_SP_ADD_PROGRESSVAR[o.progressVar.eventID]&&delete _SP_ADD_PROGRESSVAR[o.progressVar.eventID])}})})},update:function(e,t){var r=this;return r._promise(function(n){if(r.needQueue)return r._addInQueue(arguments);if(r.listID===undefined)throw"Error 'update': you need to use list() to define the list name.";var o={};if(SPExtend(!0,o,t),r.url==undefined)throw"Error 'update': not able to find the URL!";o.useCallback===!1||"function"!=typeof o.after&&n?o.useCallback=!1:o.useCallback=!0,o.where=o.where||"",o.success=o.success||function(){},o.error=o.error||function(){},o.after=o.after||function(){},o.escapeChar=o.escapeChar==undefined?!0:o.escapeChar,o.progress=o.progress||function(){},o.packetsize=o.packetsize||15,"object"==typeof e&&e.length==undefined&&(e=[e]);var i=e.length;if(1==i&&o.where)return delete e[0].ID,void r.get({fields:"ID",where:o.where},function(t){for(var i=function(e){var t={};for(var r in e)t[r]=e[r];return t},a=[],s=t.length;s--;){var l=i(e[0]);l.ID=t[s].getAttribute("ID"),a.push(l)}delete o.where,o.useCallback?r.update(a,o):r.update(a,o).then(function(e){n(e)})});if(o.progressVar=o.progressVar||{current:0,max:i,passed:[],failed:[],eventID:"spUpdate"+(""+Math.random()).slice(2)},i>o.packetsize){var a=e.slice(0),s=a.splice(0,o.packetsize);_SP_UPDATE_PROGRESSVAR[o.progressVar.eventID]=function(e){return r.update(a,e)},e=s,i=e.length}else if(0==i)return o.progress(1,1),o.error([]),o.success([]),void(o.useCallback?o.after([],[]):n([[],[]]));o.progressVar.current+=i;for(var l,u,c,d='<Batch OnError="Continue" ListVersion="1"  ViewName="">',f=0;i>f;f++){if(d+='<Method ID="'+(f+1)+'" Cmd="Update">',e[f].ID==undefined)throw"Error 'update': you have to provide the item ID called 'ID'";for(c in e[f])e[f].hasOwnProperty(c)&&(l=c,u=e[f][c],SPIsArray(u)&&(u=";#"+u.join(";#")+";#"),o.escapeChar&&"string"==typeof u&&(u=r._cleanString(u)),d+="<Field Name='"+l+"'>"+u+"</Field>");d+="</Method>"}d+="</Batch>";var h=r._buildBodyForSOAP("UpdateListItems","<listName>"+r.listID+"</listName><updates>"+d+"</updates>"),p=r.url+"/_vti_bin/lists.asmx";r.ajax({method:"POST",cache:!1,url:p,data:h,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(t){for(var i=t.getElementsByTagName("Result"),a=i.length,s=o.progressVar.passed,l=o.progressVar.failed,u=0;a>u;u++)"0x00000000"==i[u].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue&&e[u]?s.push(e[u]):e[u]&&(e[u].errorMessage=i[u].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,l.push(e[u]));o.progress(o.progressVar.current,o.progressVar.max),o.progressVar.current<o.progressVar.max?_SP_UPDATE_PROGRESSVAR[o.progressVar.eventID]&&(o.useCallback?_SP_UPDATE_PROGRESSVAR[o.progressVar.eventID](o):_SP_UPDATE_PROGRESSVAR[o.progressVar.eventID](o).then(function(e){n(e)})):(l.length>0&&o.error.call(r,l),s.length>0&&o.success.call(r,s),o.useCallback?o.after.call(r,s,l):n([s,l]),_SP_UPDATE_PROGRESSVAR[o.progressVar.eventID]&&delete _SP_UPDATE_PROGRESSVAR[o.progressVar.eventID])}})})},history:function(e,t){var r=this;if(r.needQueue)return r._addInQueue(arguments);if(r.listID===undefined)throw"Error 'history': you need to use list() to define the list name.";if(2!==arguments.length)throw"Error 'history': you need to provide two parameters.";if("object"!=typeof e)throw"Error 'history': the first parameter must be an object.";if(e.ID===undefined||e.Name===undefined)throw"Error 'history': the first parameter must be an object with ID and Name.";if("function"!=typeof t)throw"Error 'history': the second parameter must be a function.";var n=r._buildBodyForSOAP("GetVersionCollection","<strlistID>"+r.listID+"</strlistID><strlistItemID>"+e.ID+"</strlistItemID><strFieldName>"+e.Name+"</strFieldName>"),o=r.url+"/_vti_bin/lists.asmx";return r.ajax({method:"POST",cache:!1,url:o,data:n,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetVersionCollection")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){t.call(r,e.getElementsByTagName("Version"))}}),r},moderate:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(0===arguments.length||1===arguments.length&&"object"==typeof e&&e.length===undefined)throw"Error 'moderate': you need to define the list of items";if(this.listID===undefined)throw"Error 'moderate': you need to use list() to define the list name.";if(t=t||{},this.url==undefined)throw"Error 'moderate': not able to find the URL!";t.async=t.async==undefined?!0:t.async,t.success=t.success||function(){},t.error=t.error||function(){},t.after=t.after||function(){},t.progress=t.progress||function(){},"object"==typeof e&&e.length==undefined&&(e=[e]);var r=e.length;t.progressVar=t.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spModerate"+(""+Math.random()).slice(2)};var n=this;if(r>15){var o=e.slice(0),i=o.splice(0,15);return _SP_MODERATE_PROGRESSVAR[t.progressVar.eventID]=function(e){n.moderate(o,e)},this.moderate(i,t),this}if(0==r)return t.progress(1,1),t.success([]),t.error([]),t.after([],[]),this;t.progressVar.current+=r;for(var a,s,l,u='<Batch OnError="Continue" ListVersion="1"  ViewName="">',c=0;r>c;c++){if(u+='<Method ID="'+(c+1)+'" Cmd="Moderate">',e[c].ID==undefined)throw"Error 'moderate': you have to provide the item ID called 'ID'";if(e[c].ApprovalStatus==undefined)throw"Error 'moderate': you have to provide the approval status 'ApprovalStatus' (Approved, Rejected, Pending, Draft or Scheduled)";for(l in e[c]){if(e[c].hasOwnProperty(l)&&(a=l,s=e[c][l],"ApprovalStatus"==a))switch(a="_ModerationStatus",s.toLowerCase()){case"approve":case"approved":s=0;break;case"reject":case"deny":case"denied":case"rejected":s=1;break;case"pending":s=2;break;case"draft":s=3;break;case"scheduled":s=4;break;default:s=2}u+="<Field Name='"+a+"'>"+s+"</Field>"}u+="</Method>"}u+="</Batch>";var d=n._buildBodyForSOAP("UpdateListItems","<listName>"+n.listID+"</listName><updates>"+u+"</updates>"),f=n.url+"/_vti_bin/lists.asmx";return n.ajax({method:"POST",cache:!1,url:f,data:d,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){for(var o,i=r.getElementsByTagName("Result"),a=i.length,s=t.progressVar.passed,l=t.progressVar.failed,u=0;a>u;u++){o=i[u].getElementsByTagName("z:row"),0==o.length&&(o=r.getElementsByTagName("row"));var c=myElem(o[0]);"0x00000000"==i[u].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue?s.push(c):(e[u].errorMessage=i[u].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,l.push(e[u]))}t.progress(t.progressVar.current,t.progressVar.max),t.progressVar.current<t.progressVar.max?_SP_MODERATE_PROGRESSVAR[t.progressVar.eventID]&&_SP_MODERATE_PROGRESSVAR[t.progressVar.eventID](t):(s.length>0&&t.success.call(n,s),l.length>0&&t.error.call(n,l),t.after.call(n,s,l),_SP_MODERATE_PROGRESSVAR[t.progressVar.eventID]&&delete _SP_MODERATE_PROGRESSVAR[t.progressVar.eventID])}}),this},remove:function(e,t){var r=this;return r._promise(function(n){if(r.needQueue)return r._addInQueue(arguments);!t&&e.where&&(t=e,e=[]);var o={};if(SPExtend(!0,o,t),r.url==undefined)throw"Error 'remove': not able to find the URL!";o.useCallback===!1||"function"!=typeof o.after&&n?o.useCallback=!1:o.useCallback=!0,o.error=o.error||function(){},o.success=o.success||function(){},o.after=o.after||function(){},o.progress=o.progress||function(){},o.packetsize=o.packetsize||15,"object"==typeof e&&e.length==undefined&&(e=[e]);var i=e.length;if(o.where)return 1==i&&delete e[0].ID,void r.get({fields:"ID,FileRef",where:o.where},function(t){for(var i,a=function(e){var t={};for(var r in e)t[r]=e[r];return t},s=[],l=t.length;l--;){var u=a(e[0]);u.ID=t[l].getAttribute("ID"),i=t[l].getAttribute("FileRef"),i&&(u.FileRef=r.cleanResult(i)),s.push(u)}delete o.where,o.useCallback?r.remove(s,o):r.remove(s,o).then(function(e){n(e)})});if(0===i)return o.progress(1,1),o.error.call(r,[]),o.success.call(r,[]),void(o.useCallback?o.after([],[]):n([[],[]]));if(o.progressVar=o.progressVar||{current:0,max:i,passed:[],failed:[],eventID:"spRemove"+(""+Math.random()).slice(2)},i>o.packetsize){var a=e.slice(0),s=a.splice(0,o.packetsize);_SP_REMOVE_PROGRESSVAR[o.progressVar.eventID]=function(e){return r.remove(a,e)},e=s,i=e.length}o.progressVar.current+=i;for(var l='<Batch OnError="Continue" ListVersion="1"  ViewName="">',u=0;u<e.length;u++){if(l+='<Method ID="'+(u+1)+'" Cmd="Delete">',e[u].ID==undefined)throw"Error 'delete': you have to provide the item ID called 'ID'";l+="<Field Name='ID'>"+e[u].ID+"</Field>",e[u].FileRef!=undefined&&(l+="<Field Name='FileRef'>"+e[u].FileRef+"</Field>"),l+="</Method>"}l+="</Batch>";var c=r._buildBodyForSOAP("UpdateListItems","<listName>"+r.listID+"</listName><updates>"+l+"</updates>"),d=r.url+"/_vti_bin/lists.asmx";r.ajax({method:"POST",cache:!1,url:d,data:c,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(t){for(var i=t.getElementsByTagName("Result"),a=i.length,s=o.progressVar.passed,l=o.progressVar.failed,u=0;a>u;u++)"0x00000000"==i[u].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue?s.push(e[u]):(e[u].errorMessage=i[u].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,l.push(e[u]));o.progress(o.progressVar.current,o.progressVar.max),o.progressVar.current<o.progressVar.max?_SP_REMOVE_PROGRESSVAR[o.progressVar.eventID]&&(o.useCallback?_SP_REMOVE_PROGRESSVAR[o.progressVar.eventID](o):_SP_REMOVE_PROGRESSVAR[o.progressVar.eventID](o).then(function(e){n(e)})):(l.length>0&&o.error.call(r,l),s.length>0&&o.success.call(r,s),o.useCallback?o.after.call(r,s,l):n([s,l]),_SP_REMOVE_PROGRESSVAR[o.progressVar.eventID]&&delete _SP_REMOVE_PROGRESSVAR[o.progressVar.eventID])}})})},del:function(e,t){return this.remove(e,t)},usergroups:function(e,t,r){var n=this;switch(arguments.length){case 1:if("object"==typeof e)return n.usergroups("",e,function(){});if("function"==typeof e)return n.usergroups("",{},e);break;case 2:if("string"==typeof e&&"function"==typeof t)return n.usergroups(e,{},t);if("object"==typeof e&&"function"==typeof t)return n.usergroups("",e,t)}if(t=t||{},t.cache=t.cache!==!1,t.url==undefined){if(!n.url)return n._getURL(),n._addInQueue(arguments);t.url=n.url}else n.url=t.url;if(r=r||function(){},!e)throw"Error 'usergroups': you have to set an username.";e=e.toLowerCase(),t.url=t.url.toLowerCase();var o=_SP_CACHE_USERGROUPS||[];if(t.cache)for(var i=o.length;i--;)if(o[i].user.toLowerCase()==e&&o[i].url.toLowerCase()==t.url)return r.call(n,o[i].data),n;var a=n._buildBodyForSOAP("GetGroupCollectionFromUser","<userLoginName>"+e+"</userLoginName>","http://schemas.microsoft.com/sharepoint/soap/directory/"),s=t.url+"/_vti_bin/usergroup.asmx";return n.ajax({method:"POST",cache:!1,url:s,data:a,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetGroupCollectionFromUser")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(i){var a=[];i=i.getElementsByTagName("Group");for(var s=0,l=i.length;l>s;s++)a.push(i[s].getAttribute("Name"));o.push({user:e,url:t.url,data:a}),_SP_CACHE_USERGROUPS=o,r.call(n,a)},error:function(e){if(t.error===!1)r.call(n,[]);else{var o=e.responseXML.getElementsByTagName("errorstring");"object"==typeof console&&console.error("Error 'usergroups': "+o[0].firstChild.nodeValue)}}}),n},workflowStatusToText:function(e){switch(e=1*e){case 0:return"Not Started";case 1:return"Failed On Start";case 2:return"In Progress";case 3:return"Error Occurred";case 4:return"Stopped By User";case 5:return"Completed";case 6:return"Failed On Start Retrying";case 7:return"Error Occurred Retrying";case 8:return"View Query Overflow";case 15:return"Canceled";case 16:return"Approved";case 17:return"Rejected";default:return"Unknown"}},getWorkflowID:function(e){var t=this;if(t.needQueue)return t._addInQueue(arguments);if(t.listID==undefined)throw"Error 'getWorkflowID': you have to define the list ID/Name";if(t.url==undefined)throw"Error 'getWorkflowID': not able to find the URL!";if(e=e||{},e.ID==undefined||e.workflowName==undefined||e.after==undefined)throw"Error 'getWorkflowID': all parameters are mandatory";return t.get({fields:"FieldRef",where:"ID = "+e.ID},function(r){if(0===r.length)throw"Error 'getWorkflowID': I'm not able to find the item ID "+e.ID;var n=t.cleanResult(r[0].getAttribute("FileRef")),o=n.substring(0,n.indexOf("/Lists"));r=t.url.substring(0,t.url.indexOf(o)),n=r+n,"http"!==n.slice(0,4)&&(n=window.location.href.split("/").slice(0,3).join("/")+n);var i=t._buildBodyForSOAP("GetWorkflowDataForItem","<item>"+n+"</item>","http://schemas.microsoft.com/sharepoint/soap/workflow/");t.ajax({method:"POST",cache:!1,url:t.url+"/_vti_bin/Workflow.asmx",data:i,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/workflow/GetWorkflowDataForItem")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){var o,i,a={},s=r.getElementsByTagName("WorkflowTemplate");if(0===s.length){var l=SP.ClientContext.get_current(),u=l.get_web().get_lists(),c=u.getByTitle(t.listID),d=c.getItemById(e.ID);l.load(c),l.load(d);var f=c.get_workflowAssociations();l.load(f),l.executeQueryAsync(function(){for(var r=f.getEnumerator();r.moveNext();){var o=r.get_current();if(o.get_name()===e.workflowName){a={fileRef:n,description:o.get_description(),workflowID:"{"+o.get_id().toString()+"}",instances:[]};break}}e.after.call(t,a)},function(){throw"Error 'getWorkflowID': Problem while dealing with SP.ClientContext.get_current()"})}else{for(o=s.length;o--;)s[o].getAttribute("Name")==e.workflowName&&(a={fileRef:n,description:s[o].getAttribute("Description"),workflowID:"{"+s[o].getElementsByTagName("WorkflowTemplateIdSet")[0].getAttribute("TemplateId")+"}",instances:[]});if(!a.fileRef)throw"Error 'getWorkflowID': it seems the requested workflow ('"+e.workflowName+"') doesn't exist!";for(s=r.getElementsByTagName("Workflow"),o=0;o<s.length;o++)i=s[o],a.instances.push({StatusPageUrl:i.getAttribute("StatusPageUrl"),Id:i.getAttribute("Id"),TemplateId:i.getAttribute("TemplateId"),ListId:i.getAttribute("ListId"),SiteId:i.getAttribute("SiteId"),WebId:i.getAttribute("WebId"),ItemId:i.getAttribute("ItemId"),ItemGUID:i.getAttribute("ItemGUID"),TaskListId:i.getAttribute("TaskListId"),AdminTaskListId:i.getAttribute("AdminTaskListId"),Author:i.getAttribute("Author"),Modified:i.getAttribute("Modified"),Created:i.getAttribute("Created"),StatusVersion:i.getAttribute("StatusVersion"),Status1:{code:i.getAttribute("Status1"),text:t.workflowStatusToText(i.getAttribute("Status1"))},Status2:{code:i.getAttribute("Status2"),text:t.workflowStatusToText(i.getAttribute("Status2"))},Status3:{code:i.getAttribute("Status3"),text:t.workflowStatusToText(i.getAttribute("Status3"))},Status4:{code:i.getAttribute("Status4"),text:t.workflowStatusToText(i.getAttribute("Status4"))},Status5:{code:i.getAttribute("Status5"),text:t.workflowStatusToText(i.getAttribute("Status5"))},Status6:{code:i.getAttribute("Status6"),text:t.workflowStatusToText(i.getAttribute("Status6"))},Status7:{code:i.getAttribute("Status7"),text:t.workflowStatusToText(i.getAttribute("Status7"))},Status8:{code:i.getAttribute("Status8"),text:t.workflowStatusToText(i.getAttribute("Status8"))},Status9:{code:i.getAttribute("Status9"),text:t.workflowStatusToText(i.getAttribute("Status9"))},Status10:{code:i.getAttribute("Status10"),text:t.workflowStatusToText(i.getAttribute("Status10"))},TextStatus1:i.getAttribute("TextStatus1"),TextStatus2:i.getAttribute("TextStatus2"),TextStatus3:i.getAttribute("TextStatus3"),TextStatus4:i.getAttribute("TextStatus4"),TextStatus5:i.getAttribute("TextStatus5"),Modifications:i.getAttribute("Modifications"),InternalState:i.getAttribute("InternalState"),ProcessingId:i.getAttribute("ProcessingId")});e.after.call(t,a)}return t},error:function(){throw"Error 'getWorkflowID': Something went wrong with the request over the Workflow Web Service..."}})}),t},startWorkflow:function(e){var t=this;if(t.needQueue)return t._addInQueue(arguments);if(t.url==undefined)throw"Error 'startWorkflow': not able to find the URL!";if(!t.listID)return e.platformType=2010,t.startWorkflow2013(e);if(e=e||{},e.after=e.after||function(){},!e.workflowName&&!e.workflowID)throw"Error 'startWorkflow': Please provide the workflow name!";if(!e.ID)throw"Error 'startWorkflow': Please provide the item ID!";if(e.fileRef||e.workflowID){var r="<root />";if(e.parameters){var n;e.parameters.length==undefined&&(e.parameters=[e.parameters]),n=e.parameters.slice(0),r="<Data>";for(var o=0;o<n.length;o++)r+="<"+n[o].name+">"+n[o].value+"</"+n[o].name+">";r+="</Data>"}var i=t._buildBodyForSOAP("StartWorkflow","<item>"+e.fileRef+"</item><templateId>"+e.workflowID+"</templateId><workflowParameters>"+r+"</workflowParameters>","http://schemas.microsoft.com/sharepoint/soap/workflow/"),a=t.url+"/_vti_bin/Workflow.asmx";t.ajax({method:"POST",cache:!1,url:a,data:i,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/workflow/StartWorkflow")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(){e.after.call(t)},error:function(r,n,o){e.after.call(t,o)}})}else t.getWorkflowID({ID:e.ID,workflowName:e.workflowName,after:function(r){e.fileRef=r.fileRef,e.workflowID=r.workflowID,t.startWorkflow(e)}});return t},startWorkflow2013:function(e){var t=this;if(t.needQueue)return t._addInQueue(arguments);if(t.url==undefined)throw"Error 'startWorkflow2013': not able to find the URL!";if(e=e||{},e.after=e.after||function(){},e.platformType=e.platformType||2013,!e.workflowName)throw"Error 'startWorkflow2013': Please provide the workflow name!";if(t.listID&&!e.ID)throw"Error 'startWorkflow2013': Please provide the item ID!";if("undefined"==typeof SP||"undefined"==typeof SP.SOD)throw"Error 'startWorkflow2013': SP.SOD.executeFunc is required (from the Microsoft file called init.js)";
 return SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){SP.SOD.registerSod("sp.workflowservices.js",SP.Utilities.Utility.getLayoutsPageUrl("sp.workflowservices.js")),SP.SOD.executeFunc("sp.workflowservices.js","SP.WorkflowServices.WorkflowServicesManager",function(){var r=new SP.ClientContext(t.url),n=r.get_web(),o=SP.WorkflowServices.WorkflowServicesManager.newObject(r,n);r.load(o);var i=o.getWorkflowSubscriptionService().enumerateSubscriptions();r.load(i),r.executeQueryAsync(function(){var n,a,s=i.getEnumerator(),l={},u=!1,c=e.workflowName.toLowerCase();if(e.parameters)for(e.parameters.length===undefined&&(e.parameters=[e.parameters]),a=0;a<e.parameters.length;a++)l[e.parameters[a].name]=e.parameters[a].value;if(2010==e.platformType){var d=o.getWorkflowInteropService();d.startWorkflow(c,null,null,null,l),r.executeQueryAsync(function(){e.after.call(t)},function(r,n){var o=n.get_message();"associationName"===o&&(o="No workflow found with the name '"+e.workflowName+"'"),e.after.call(t,o)})}else{for(;s.moveNext();)if(n=s.get_current(),n.get_name().toLowerCase()===c){e.ID?o.getWorkflowInstanceService().startWorkflowOnListItem(n,e.ID,l):o.getWorkflowInstanceService().startWorkflow(n,l),r.executeQueryAsync(function(){e.after.call(t)},function(r,n){e.after.call(t,n.get_message())}),u=!0;break}u||e.after.call(t,"No workflow found with the name '"+e.workflowName+"'")}},function(r,n){e.after.call(t,n.get_message())})})}),this},distributionLists:function(e,t,r){var n=this;switch(arguments.length){case 1:if("object"==typeof e)return n.distributionLists("",e,function(){});if("function"==typeof e)return n.distributionLists("",{},e);break;case 2:if("string"==typeof e&&"function"==typeof t)return n.distributionLists(e,{},t);if("object"==typeof e&&"function"==typeof t)return n.distributionLists("",e,t)}if(t=t||{},t.url==undefined){if(!n.url)return n._getURL(),n._addInQueue(arguments);t.url=n.url}else n.url=t.url;if(r=r||function(){},!e)throw"Error 'distributionLists': you have to set an username.";e=e.toLowerCase(),t.url=t.url.toLowerCase(),t.cache=t.cache!==!1;var o=_SP_CACHE_DISTRIBUTIONLISTS||[];if(t.cache)for(var i=o.length;i--;)if(o[i].user===e&&o[i].url===t.url)return r.call(n,o[i].data),n;var a=n._buildBodyForSOAP("GetCommonMemberships","<accountName>"+e+"</accountName>","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService"),s=t.url+"/_vti_bin/UserProfileService.asmx";return n.ajax({method:"POST",cache:!1,url:s,data:a,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserMemberships")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(i){var a=[];i=i.getElementsByTagName("MembershipData");for(var s=0,l=i.length;l>s;s++)"DistributionList"===i[s].getElementsByTagName("Source")[0].firstChild.nodeValue&&a.push({SourceReference:i[s].getElementsByTagName("SourceReference")[0].firstChild.nodeValue,DisplayName:i[s].getElementsByTagName("DisplayName")[0].firstChild.nodeValue,MailNickname:i[s].getElementsByTagName("MailNickname")[0].firstChild.nodeValue,Url:i[s].getElementsByTagName("Url")[0].firstChild.nodeValue});o.push({user:e,url:t.url,data:a}),_SP_CACHE_DISTRIBUTIONLISTS=o,r.call(n,a)},error:function(){r.call(n,[])}}),n},groupMembers:function(e,t,r){var n=this;switch(arguments.length){case 1:if("object"==typeof e)return n.groupMembers("",e,function(){});if("function"==typeof e)return n.groupMembers("",{},e);break;case 2:if("string"==typeof e&&"function"==typeof t)return n.groupMembers(e,{},t);if("object"==typeof e&&"function"==typeof t)return n.groupMembers("",e,t)}if(t=t||{},t.cache=t.cache===undefined?!0:t.cache,t.url==undefined){if(!n.url)return n._getURL(),n._addInQueue(arguments);t.url=n.url}else n.url=t.url;if(r=r||function(){},!e)throw"Error 'groupMembers': you have to set an groupname.";e=e.toLowerCase(),t.url=t.url.toLowerCase();var o=[];if(t.cache){o=_SP_CACHE_GROUPMEMBERS||[];for(var i=o.length;i--;)if(o[i].group===e&&o[i].url===t.url)return r.call(n,o[i].data),n}var a=n._buildBodyForSOAP("GetUserCollectionFromGroup","<groupName>"+n._cleanString(e)+"</groupName>","http://schemas.microsoft.com/sharepoint/soap/directory/"),s=t.url+"/_vti_bin/usergroup.asmx";return n.ajax({method:"POST",cache:!1,url:s,data:a,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetUserCollectionFromGroup")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(i){var a=[];i=i.getElementsByTagName("User");for(var s=0,l=i.length;l>s;s++)a.push({ID:i[s].getAttribute("ID"),Name:i[s].getAttribute("Name"),LoginName:i[s].getAttribute("LoginName"),Email:i[s].getAttribute("Email")});o.push({group:e,url:t.url,data:a}),_SP_CACHE_GROUPMEMBERS=o,r.call(n,a)},error:function(e){if(t.error===!1)r.call(n,[]);else{var o=e.responseXML.getElementsByTagName("errorstring");"object"==typeof console&&console.error("Error 'groupMembers': "+o[0].firstChild.nodeValue)}}}),n},isMember:function(e,t){if(e=e||{},e.cache=e.cache!==!1,e.url==undefined){if(!this.url)return this._getURL(),this._addInQueue(arguments);e.url=this.url}else this.url=e.url;if(t=t||function(){},!e.user)throw"Error 'isMember': you have to set an user.";if(!e.group)throw"Error 'isMember': you have to set a group.";return e.group=e.group.toLowerCase(),this.usergroups(e.user,{cache:e.cache,error:!1},function(r){for(var n=r.length;n--;)if(r[n].toLowerCase()===e.group)return t.call(this,!0),this;this.groupMembers(e.group,{cache:e.cache,error:!1},function(r){for(var n=[],o=r.length;o--;)n.push(r[o].Name.toLowerCase());this.distributionLists(e.user,{cache:e.cache},function(e){for(var r=e.length;r--;)if(SPArrayIndexOf(n,e[r].DisplayName.toLowerCase())>-1)return t.call(this,!0),this;return t.call(this,!1),this})})}),this},people:function(e,t,r){var n=this;switch(arguments.length){case 1:if("object"==typeof e)return n.people("",e,function(){});if("function"==typeof e)return n.people("",{},e);e=undefined;break;case 2:if("string"==typeof e&&"function"==typeof t)return n.people(e,{},t);if("object"==typeof e&&"function"==typeof t)return n.people("",e,t)}if(t=t||{},t.url==undefined){if(!n.url)return n._getURL(),n._addInQueue(arguments);t.url=n.url}else n.url=t.url;r=r||function(){},e=e||"";var o=n._buildBodyForSOAP("GetUserProfileByName","<AccountName>"+e+"</AccountName>","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService"),i=t.url+"/_vti_bin/UserProfileService.asmx";return n.ajax({method:"POST",cache:!1,url:i,data:o,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserProfileByName")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var t=[];e=e.getElementsByTagName("PropertyData");for(var o=0,i=e.length;i>o;o++){var a=e[o].getElementsByTagName("Name")[0].firstChild.nodeValue,s=e[o].getElementsByTagName("Value");s=s&&s.length>=1&&s[0].firstChild?s[0].firstChild.nodeValue:"No Value",t.push(a),t[a]=s}r.call(n,t)},error:function(e){var t=e.responseXML.getElementsByTagName("faultstring");r.call(n,"Error 'people': "+t[0].firstChild.nodeValue)}}),n},getUserInfo:function(e,t,r){var n=this;if("string"!=typeof e)throw"Error 'getUserInfo': the first argument must be the username";switch(arguments.length){case 2:if("function"==typeof t)return n.getUserInfo(e,{},t);if("object"==typeof t)return n.getUserInfo(e,t,function(){});break;case 3:if("object"!=typeof t&&"function"!=typeof r)throw"Error 'getUserInfo': incorrect arguments, please review the documentation"}if(t=t||{},t.url==undefined){if(!n.url)return n._getURL(),n._addInQueue(arguments);t.url=n.url}else n.url=t.url;r=r||function(){};var o=n._buildBodyForSOAP("GetUserInfo","<userLoginName>"+e+"</userLoginName>","http://schemas.microsoft.com/sharepoint/soap/directory/"),i=t.url+"/_vti_bin/usergroup.asmx";return n.ajax({method:"POST",cache:!1,url:i,data:o,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){e=e.getElementsByTagName("User"),0===e.length?r.call(n,"Error 'getUserInfo': nothing returned?!"):r.call(n,{ID:e[0].getAttribute("ID"),Sid:e[0].getAttribute("Sid"),Name:e[0].getAttribute("Name"),LoginName:e[0].getAttribute("LoginName"),Email:e[0].getAttribute("Email"),Notes:e[0].getAttribute("Notes"),IsSiteAdmin:e[0].getAttribute("IsSiteAdmin"),IsDomainGroup:e[0].getAttribute("IsDomainGroup"),Flags:e[0].getAttribute("Flags")})},error:function(e){var t=e.responseXML.getElementsByTagName("errorstring");r.call(n,"Error 'getUserInfo': "+t[0].firstChild.nodeValue)}}),this},whoami:function(e,t){return"function"==typeof e&&(t=e,e={}),this.people("",e,t)},regionalSettings:function(e){var t=this;return t.url?("function"!=typeof e&&(e=function(){}),_SP_CACHE_REGIONALSETTINGS&&e.call(t,_SP_CACHE_REGIONALSETTINGS),t.ajax({method:"GET",url:t.url+"/_layouts/regionalsetng.aspx?Type=User",success:function(r){var n={lcid:"",cultureInfo:"",timeZone:"",calendar:"",alternateCalendar:""},o=document.createElement("div");o.innerHTML=r;var i,a,s=function(e){var t=o.querySelector("select[id$='"+e+"']");return t.options[t.selectedIndex].innerHTML};for(n.lcid=o.querySelector("select[id$='LCID']").value,n.cultureInfo=s("LCID"),n.timeZone=s("TimeZone"),n.calendar=s("DdlwebCalType"),n.alternateCalendar=s("DdlwebAltCalType"),i=document.querySelectorAll("input[id*='ChkListWeeklyMultiDays']"),n.workWeek={days:[],firstDayOfWeek:"",firstWeekOfYear:"",startTime:"",endTime:""},a=0;a<i.length;a++)i[a].checked&&n.workWeek.days.push(i[a].nextSibling.querySelector("abbr").getAttribute("title"));n.workWeek.firstDayOfWeek=s("DdlFirstDayOfWeek"),n.workWeek.firstWeekOfYear=s("DdlFirstWeekOfYear"),n.workWeek.startTime=o.querySelector("select[id$='DdlStartTime']").value,n.workWeek.endTime=o.querySelector("select[id$='DdlEndTime']").value,n.timeFormat=s("DdlTimeFormat"),_SP_CACHE_REGIONALSETTINGS=n,e.call(t,n)},error:function(r,n,o){e.call(t,"Error: ["+n+"] "+o)}}),t):(t._getURL(),t._addInQueue(arguments))},regionalDateFormat:function(e){var t=this;if(!t.url)return t._getURL(),t._addInQueue(arguments);"function"!=typeof e&&(e=function(){}),_SP_CACHE_DATEFORMAT&&e.call(t,_SP_CACHE_DATEFORMAT);var r="";return"undefined"!=typeof _spRegionalSettings?r=_spRegionalSettings.localeId:_SP_CACHE_REGIONALSETTINGS&&(r=_SP_CACHE_REGIONALSETTINGS.lcid),r?(t.ajax({method:"GET",url:t.url+"/_layouts/iframe.aspx?cal=1&date=1/1/2000&lcid="+r,success:function(r){var n=document.createElement("div");n.innerHTML=r;var o=n.querySelector('a[id="20000103"]').getAttribute("href").replace(/javascript:ClickDay\('(.*)'\)/,"$1"),i=/\\u([\d\w]{4})/gi;o=o.replace(i,function(e,t){return String.fromCharCode(parseInt(t,16))}),o=unescape(o),o=o.replace(/20/,"YY"),o=o.replace(/00/,"YY"),o=o.replace(/03/,"DD"),o=o.replace(/3/,"D"),o=o.replace(/01/,"MM"),o=o.replace(/1/,"M"),_SP_CACHE_DATEFORMAT=o,e.call(t,o)},error:function(r,n,o){e.call(t,"Error: ["+n+"] "+o)}}),t):t.regionalSettings(function(){t.regionalDateFormat(e)})},addressbook:function(e,t,r){var n=this;switch(arguments.length){case 1:if("object"==typeof e)return n.addressbook("",e,function(){});if("function"==typeof e)return n.addressbook("",{},e);if("string"==typeof e)return n.addressbook(e,{},function(){});e=undefined;break;case 2:if("string"==typeof e&&"function"==typeof t)return n.addressbook(e,{},t);if("object"==typeof e&&"function"==typeof t)return n.addressbook("",e,t)}if(t=t||{},t.url==undefined){if(!n.url)return n._getURL(),n._addInQueue(arguments);t.url=n.url}else n.url=t.url;t.limit=t.limit||10,t.type=t.type||"User",r=r||function(){},e=e||"";var o=n._buildBodyForSOAP("SearchPrincipals","<searchText>"+e+"</searchText><maxResults>"+t.limit+"</maxResults><principalType>"+t.type+"</principalType>"),i=t.url+"/_vti_bin/People.asmx";return n.ajax({method:"POST",cache:!1,url:i,data:o,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/SearchPrincipals")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var t=[];e=e.getElementsByTagName("PrincipalInfo");for(var o=0,i=e.length;i>o;o++){var a=e[o].childNodes;t[o]=[];for(var s=0,l=a.length;l>s;s++){var u=a[s].nodeName,c=a[s].firstChild;c&&(c=c.nodeValue),t[o].push(u),t[o][u]=c}}r.call(n,t)}}),n},reset:function(){var e=this;e.data=[],e.length=0,e.listID="",e.needQueue=!1,e.listQueue=[],delete e.url},toDate:function(e,t){if(!e)return"";if(e instanceof Date)return e;if(19!=e.length&&20!=e.length)throw"toDate: '"+e+"' is invalid.";var r=e.substring(0,4),n=e.substring(5,7),o=e.substring(8,10),i=e.substring(11,13),a=e.substring(14,16),s=e.substring(17,19);return e.indexOf("Z")>-1||t?new Date(Date.UTC(r,n-1,o,i,a,s)):new Date(r,n-1,o,i,a,s)},toSPDate:function(e,t){var r=function(e){return 1==e.toString().length&&(e="0"+e),e},n=r(e.getMonth()+1),o=r(e.getDate()),i=e.getFullYear(),a=r(e.getHours()),s=r(e.getMinutes()),l=r(e.getSeconds());return i+"-"+n+"-"+o+(t?" "+a+":"+s+":"+l:"")},toCurrency:function(e,t,r){e=Number(e),t===undefined&&(t=-1),r===undefined&&(r="$");var n="";0>e&&(n="-",e*=-1);var o=e;o=-1===t?o.toFixed(2).replace(".00",""):o.toFixed(t);for(var i=(Math.floor(e)+"").length,a=0,s=0,l=i%3;i>a;a++)0!=a&&a%3==l&&(o=o.substr(0,a+s)+","+o.substr(a+s),s++);return(""!=r?r:"")+n+o+(""!=r?"":" "+r)},getLookup:function(e){if(!e)return{id:"",value:""};var t=e.split(";#");return{id:t[0],value:t[1]}},toXSLString:function(e){if("string"!=typeof e)throw"Error 'toXLSString': '"+e+"' is not a string....";var t=function(e){for(var t=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"),r="",n=0;n<e.length;n++){for(var o=e.charAt(n),i=o.charCodeAt(0),a=0,s="";i>=16;)a=i%16,i=Math.floor(i/16),s+=t[a];s+=t[i];for(var l="",u=s.length-1;u>=0;u--)l+=s.charAt(u);r+="%"+l}return r},r=e.split(" "),n="";/^[0-9]/.test(r[0])&&r[0].length<5&&(n=t(e.charAt(0)),e=e.substring(1));for(var o=0;o<e.length;o++){var i=e.charAt(o);n+=/[0-9A-Za-z_]/.test(i)===!1?t(i).toLowerCase():i}return n.replace(/%([a-zA-Z0-9][a-zA-Z0-9])/g,"_x00$1_").substring(0,32)},formfields:function(fields,settings){"use strict";this.reset(),1==arguments.length&&"object"==typeof fields&&"undefined"==typeof fields.length&&(settings=fields,fields=undefined),settings=settings||{},fields=fields||[],settings.cache=settings.cache!==!1;var aReturn=[],bigLimit=1e4;"string"==typeof fields&&(fields=""===fields?[]:fields.split(","));var limit=fields.length>0?fields.length:bigLimit;if(limit!==bigLimit||settings.mandatory||(settings.includeAll=!0),settings.cache&&null!==_SP_CACHE_FORMFIELDS){var allFields=_SP_CACHE_FORMFIELDS.slice(0);if(settings.includeAll)return this.length=allFields.length,this.data=allFields,this;var done=0,i,len=allFields.length,idx,fieldNames=[];for(i=0;len>i;i++)fieldNames.push(allFields[i]._name);for(i=0;limit>i;i++)idx=SPArrayIndexOf(fieldNames,fields[i]),idx>-1&&aReturn.push(allFields[idx]);for(i=0,len=settings.mandatory?allFields.length:0;len>i;i++)allFields[i]._isMandatory&&-1===SPArrayIndexOf(fields,allFields[i]._name)&&aReturn.push(allFields[i]);return this.length=aReturn.length,this.data=aReturn,this}settings.includeAll=!0,settings.cache=!0;var getFieldInfoFromComments=function(e){var t=[];if("undefined"==typeof document.createNodeIterator)for(var r={COMMENT_NODE:8},n=e.childNodes,o=0,i=n.length;i>o;o++)n[o].nodeType==r.COMMENT_NODE&&t.push(n[o].nodeValue);else for(var a,s=function(){return NodeFilter.FILTER_ACCEPT},l=document.createNodeIterator(e,NodeFilter.SHOW_COMMENT,s,!1);a=l.nextNode();)t.push(a.nodeValue);var u=t.join("").replace(/\s\s*/g," ").match(/FieldName="([^"]+)".* FieldInternalName="([^"]+)".* FieldType="([^"]+)"/);return u?{Name:u[1],InternalName:u[2],SPType:u[3]}:{Name:"",InternalName:"",SPType:""}},getText=function(e){var t,r,n=e.nodeType,o="";if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;if("string"==typeof e.innerText)return e.innerText.replace(/\r/g,"");for(e=e.firstChild;e;e=e.nextSibling)o+=getText(e)}else if(3===n||4===n)return e.nodeValue}else for(t=0;r=e[t];t++)8!==r.nodeType&&(o+=getText(r));return o},setSelectedOption=function(e,t,r){r=r||"text";for(var n,o=e.querySelectorAll("option"),i=SPIsArray(t),a=0,s=o.length;s>a;a++)"all"===r?o[a].selected=!0:"none"===r?o[a].selected=!1:(n="text"===r?o[a].innerHTML:o[a].value,o[a].selected=i?SPArrayIndexOf(t,n)>-1:t==n)},getSelectedOption=function(e,t){t=t||"text";for(var r=e.querySelectorAll("option"),n=[],o=null!==e.getAttribute("multiple"),i=0,a=r.length;a>i;i++)if(r[i].selected){if("text"===t){if(n.push(getText(r[i])),o)continue;return n[0]||""}if("value"===t){if(n.push(r[i].value),o)continue;return n[0]||""}if("both"===t){if(n.push({text:getText(r[i]),value:r[i].value}),o)continue;return n[0]||""}}return o?n:0===n.length?"":n};settings.includeAll&&(limit=bigLimit);for(var a=document.querySelectorAll("td.ms-formbody"),i=-1,len=a.length,done=0;len>i&&limit>done;i++){var tr,td,isMandatory=!1,html,txt,infoFromComments,includeThisField=!1,search,fieldName,obj,tmp;if(settings.includeAll&&(includeThisField=!0),-1===i)(includeThisField||SPArrayIndexOf(fields,"Content Type")>-1)&&(infoFromComments={Name:"Content Type",InternalName:"Content_x0020_Type",SPType:"SPContentType"},includeThisField=!0);else{if(tr=a[i].parentNode,td=tr.querySelector("td.ms-formbody"),infoFromComments=getFieldInfoFromComments(a[i]),!infoFromComments.Name){if("idAttachmentsRow"!==tr.getAttribute("id"))continue;infoFromComments={Name:"Attachments",InternalName:"Attachments",SPType:"SPAttachments"},includeThisField=!0}if(txt=tr.querySelector("td.ms-formlabel nobr"),!txt)continue;txt=getText(txt),isMandatory=/ \*$/.test(txt),settings.mandatory&&isMandatory?includeThisField=!0:limit!==bigLimit&&SPArrayIndexOf(fields,infoFromComments.Name)>-1&&(includeThisField=!0,done++)}if(includeThisField){if(fieldName=infoFromComments.Name,obj={_name:fieldName,_internalname:infoFromComments.InternalName,_isMandatory:isMandatory,_description:"",_elements:[],_tr:null,_type:null},"Content Type"===fieldName){if(obj._elements=document.querySelector('.ms-formbody select[title="Content Type"]'),!obj._elements)continue;obj._type="content type",obj._tr=obj._elements.parentNode.parentNode}else obj._tr=tr;if(obj.val=function(){},obj.elem=function(e){e=e!==!1;var t=this._elements,r="function"==typeof jQuery&&e===!0;if(t instanceof NodeList&&(t=[].slice.call(t)),!SPIsArray(t))return r?jQuery(t):t;switch(t.length){case 0:return r?jQuery():null;case 1:return r?jQuery(t[0]):t[0];default:return r?jQuery(t):t}},obj.description=function(){return this._description},obj.type=function(){return this._type},obj.row=function(){return"function"==typeof jQuery?jQuery(this._tr):this._tr},obj.name=function(){return this._name},obj.internalname=function(){return this._internalname},obj.isMandatory=function(){return this._isMandatory},obj.options=function(){},"Attachments"===obj._name)obj._type="attachments",obj.elem=function(e){e=e!==!1;var t=document.getElementById("idAttachmentsRow").querySelector(".ms-formbody").querySelectorAll("tr"),r="function"==typeof jQuery&&e===!0;switch(t.length){case 0:return r?jQuery():null;case 1:return r?jQuery(t[0]):t[0];default:return r?jQuery(t):t}},obj.val=function(e){if("undefined"==typeof e){e=[];var t=this.elem(!1);if(t){t.length||(t=[t]);for(var r=0;r<t.length;r++)e.push(getText(t[r].querySelector("span")))}return e}return this};else if("Content Type"===obj._name)obj.val=function(v){var e=this.elem(!1);return"undefined"==typeof v?getSelectedOption(e,"text"):(setSelectedOption(e,v,"text"),eval("!function() {"+e.getAttribute("onchange").replace(/javascript:/,"")+"}()"),this)};else switch(tmp=td.querySelector(".ms-metadata"),tmp&&tmp.parentNode==td?obj._description=getText(tmp).trim():(tmp=td.childNodes,tmp=tmp[tmp.length-1],3==tmp.nodeType&&(obj._description=getText(tmp).trim())),infoFromComments.SPType){case"SPFieldText":case"SPFieldCurrency":case"SPFieldNumber":switch(infoFromComments.SPType){case"SPFieldCurrency":obj._type="currency";break;case"SPFieldNumber":obj._type="number";break;default:obj._type="text"}obj._elements.push(td.querySelector('input[type="text"]')),obj.val=function(e){var t=this.elem(!1);return"undefined"!=typeof e?(t.value=e,this):t.value};break;case"SPFieldNote":obj._type="text multiple",tmp=td.querySelector("textarea"),tmp?(obj._elements.push(tmp),obj.val=function(e){var t=this.elem(),r=this.type();if("iframe"===t[0].tagName.toLowerCase()){var n=1===t.length?t[0]:t[1],o=n.contentDocument?n.contentDocument:n.contentWindow.document;if(!e)return o.getElementsByTagName("div")[0].innerHTML;o.getElementsByTagName("div")[0].innerHTML=e}else{if("undefined"==typeof e)return t[0].value;t[0].value=e,"text multiple"===r&&(t[0].innerHTML=e)}return this}):(obj._type="html multiple",obj._elements.push(td.querySelector("div")),obj.val=function(e){var t=this.elem();if(t=t[0].querySelector("div[contenteditable]")){if(e===undefined)return t.innerHTML.replace(/^<div class="?ExternalClass[0-9A-Z]+"?>([\s\S]*)<\/div>$/i,"$1").replace(/<span (rtenodeid="1" )?id="?ms-rterangecursor-start"?><\/span><span (rtenodeid="3" )?id="?ms-rterangecursor-end"?([^>]+)?><\/span>/gi,"").replace(/^<p><\/p>$/,"");t.innerHTML=e}return e!==undefined?this:null});break;case"SPFieldUser":case"SPFieldUserMulti":obj._type="people"+("SPFieldUserMulti"===infoFromComments.SPType?" multiple":""),tmp=td.querySelector('div[contenteditable="true"]'),tmp?(obj._elements.push(tmp),obj._elements.push(td.querySelector("textarea")),!function(){for(var e=td.querySelectorAll("a"),t=0;t<e.length;t++)obj._elements.push(e[t])}()):obj._elements.push(td.querySelector("div[id]")),"function"==typeof GetPickerControlValue&&(tmp=td.querySelector("table.ms-usereditor"),tmp&&(tmp=tmp.querySelectorAll("span"),tmp&&(obj._description=getText(tmp[tmp.length-1]).trim()))),obj.val=function(e){var t,r,n=[],o=!1,i=this.elem(!1);if("object"!=typeof e||SPIsArray(e)||e.extend!==!0||(e=void 0,o=!0),r=(SPIsArray(i)?i[0]:i).getAttribute("id").replace(/_upLevelDiv$/,""),"undefined"==typeof e)return"function"==typeof GetPickerControlValue?o===!1?GetPickerControlValue(r,!1,!0).trim():(e=GetPickerControlValue(r,!1,!1),t=document.createElement("div"),t.innerHTML=e,e=t.querySelector("#divEntityData"),e?{Key:e.getAttribute("key"),DisplayText:e.getAttribute("DisplayText")}:{Key:"",DisplayText:GetPickerControlValue(r,!1,!0).trim()}):"function"==typeof SPClientPeoplePicker?(t=SPClientPeoplePicker.SPClientPeoplePickerDict[r],t?(t=t.GetAllUserInfo(),o?0===t.length?{Key:"",DisplayText:""}:1===t.length?t[0]:t:(SPArrayForEach(t,function(e){n.push(e.DisplayText)}),0===n.length?"":1===n.length?n[0]:n)):""):JSON.parse(this.elem(!1).querySelector("input").value)[0].ResolveText;if("function"==typeof EntityEditorCallback)SPIsArray(e)||(e=[e]),t='<Entities Append="False" Error="" Separator=";" MaxHeight="3">',SPArrayForEach(e,function(e){t+='<Entity Key="'+e+'" DisplayText="'+e+'" IsResolved="False" Description="'+e+'"><MultipleMatches /></Entity>'}),t+="</Entities>",EntityEditorCallback(t,r,!1),e=getUplevel(r),WebForm_DoCallback(r.replace(/(ctl\d+)(\_)/g,"$1$").replace(/(^ctl\d+\$m)(\_)/,"$1$").replace(/\_ctl/,"$ctl"),e,EntityEditorHandleCheckNameResult,r,EntityEditorHandleCheckNameError,!0);else{if("function"!=typeof SPClientPeoplePicker)throw new Error("$SP().formfields().val() failed with a People Picker, because EntityEditorCallback and SPClientPeoplePicker are not available!");if(n=SPClientPeoplePicker.SPClientPeoplePickerDict[r],!n)throw new Error("$SP().formfields().val() failed with a People Picker, because SPClientPeoplePicker.SPClientPeoplePickerDict['"+r+"'] returned an unexpected value");if(t=document.getElementById(n.ResolvedListElementId))for(t=t.querySelectorAll("span"),r=t.length;r--;)n.DeleteProcessedUser();SPIsArray(e)&&(e=e.join(";")),n.AddUserKeys(e,!1)}return this};break;case"SPFieldChoice":case"SPFieldMultiChoice":obj._type="choices",tmp=td.querySelector("table"),tmp?(tmp=td.querySelector("select"),tmp?(obj._type="choices plus",obj._elements=td.querySelectorAll("input,select")):(tmp=td.querySelector('input[type="checkbox"]'),tmp?obj._type="choices checkbox":obj._type="choices radio",tmp=td.querySelector('input[type="text"]'),tmp&&(obj._type+=" plus"),obj._elements=td.querySelectorAll("input"))):obj._elements=td.querySelector("select"),obj.val=function(e){var t,r,n,o=this.elem(!1),i=this.type();if("undefined"==typeof e)switch(i){case"choices":return getSelectedOption(o,"text");case"choices plus":return o[0].checked?getSelectedOption(o[1],"text"):o[3].value;case"choices radio":for(t=0;t<o.length;t++)if(o[t].checked)return getText(o[t].nextSibling);return"";case"choices radio plus":for(t=0;t<o.length-2;t++)if(o[t].checked)return getText(o[t].nextSibling);return o[t].checked?o[t+1].value:"";case"choices checkbox":case"choices checkbox plus":for(e=[],r="choices checkbox plus"===i,n=o.length,r&&n--,t=0;n>t;t++)o[t].checked&&e.push(r&&t+1===n?o[n].value:getText(o[t].nextSibling));return e}else switch(i){case"choices":setSelectedOption(o,e,"text");break;case"choices plus":o[0].checked=!0,setSelectedOption(o[1],e,"text"),getSelectedOption(o[1],"text")!==e?(o[2].checked=!0,o[3].value=e):o[3].value="";break;case"choices checkbox":case"choices checkbox plus":for(SPIsArray(e)||(e=[e]),n=o.length,"choices checkbox plus"===i&&(n-=2),t=0;n>t;t++)idx=SPArrayIndexOf(e,getText(o[t].nextSibling)),idx>-1?(o[t].checked=!0,e.splice(idx,1)):o[t].checked=!1;"choices checkbox plus"===i&&(e.length>0?(o[o.length-2].checked=!0,o[o.length-1].value=e[0]):(o[o.length-2].checked=!1,o[o.length-1].value=""));break;case"choices radio":case"choices radio plus":for(r=!1,n=o.length,"choices radio plus"===i&&(n-=2),t=0;n>t;t++)if(getText(o[t].nextSibling)==e){o[t].checked=!0,r=!0;break}"choices radio plus"===i&&(r?o[t+1].value="":(o[t].checked=!0,o[t+1].value=e))}return this};break;case"SPFieldDateTime":obj._type="date",tmp=td.querySelectorAll("input,select,a"),tmp.length>2&&(obj._type+=" time"),obj._elements=obj._elements.concat(tmp),obj.val=function(e){var t=this.elem();return"undefined"!=typeof e?(SPIsArray(e)||(e=[e]),t[0].value=e[0],4===t.length&&(e.length>1&&setSelectedOption(t[2],e[1]),e.length>2&&setSelectedOption(t[3],e[2])),this):4===t.length?[t[0].value,getSelectedOption(t[2],"text"),t[3].value]:t[0].value};break;case"SPFieldLookup":case"SPFieldLookupMulti":obj._type="lookup",obj._elements=td.querySelectorAll('select,input[id$="Button"],button'),"SPFieldLookupMulti"===infoFromComments.SPType?obj._type+=" multiple":obj._elements=obj._elements[0],obj.val=function(v){var params="text";"object"!=typeof v||SPIsArray(v)||(params=v.selectReturn||"text",v=void 0);var type=this.type(),e=this.elem(!1),o;if("undefined"==typeof v){if("lookup multiple"===type){for(e=e[3].querySelectorAll("option"),v=[],o=0;o<e.length;o++)v.push("text"===params?getText(e[o]):e[o].value);return 0===v.length?"":v}return getSelectedOption(e,params)}if("lookup multiple"===type){SPIsArray(v)||(v=[v]);var clickAdd=e[1].getAttribute("onclick"),clickRemove=e[2].getAttribute("onclick"),masterGroup=window[e[1].getAttribute("id").replace(/AddButton/,"MultiLookup_m")];for(setSelectedOption(e[3],"","all"),clickRemove?eval("!function() {"+clickRemove+"}()"):"function"==typeof GipRemoveSelectedItems&&GipRemoveSelectedItems(masterGroup),setSelectedOption(e[0],"","none"),o=0;o<v.length;o++)setSelectedOption(e[0],v[o],params),clickAdd?eval("!function() {"+clickAdd+"}()"):"function"==typeof GipAddSelectedItems&&GipAddSelectedItems(masterGroup)}else setSelectedOption(e,v,params);return this};break;case"SPFieldBoolean":obj._type="boolean",obj._elements=td.querySelector("input"),obj.val=function(e){var t=this.elem(!1);return"undefined"!=typeof e?(t.checked=1==e,this):t.checked};break;case"SPFieldURL":obj._type="url",obj._elements=td.querySelectorAll("span.ms-formdescription,input"),obj.val=function(e){var t=this.elem();return"undefined"!=typeof e&&(SPIsArray(e)||(e=[e,e]),e.length<2&&(e=[e[0],e[0]]),t[1].value=e[0],t[3].value=e[1]),[t[1].value,t[3].value]}}}aReturn.push(obj)}return _SP_CACHE_FORMFIELDS=aReturn.slice(0),settings.includeAll=!1,this.formfields(fields,settings)},each:function(e){for(var t=0,r=this.data.length;r>t;t++)e.call(this.data[t]);return this},val:function(e){var t=!1,r=!1;if("object"!=typeof e||SPIsArray(e)||(t=e.identity===!0,r=e.extend===!0,e=void 0),"undefined"==typeof e){var n=[];return this.each(function(){t===!0?n[this.name()]=this.val():r===!0&&"people"===this.type().slice(0,6)?n.push(this.val({extend:r})):n.push(this.val())}),0===n.length?"":1===n.length?n[0]:n}if("object"!=typeof e)this.each(function(){this.val(e)});else{var o=0;if(this.length>1){if(e.length!==this.length)throw new Error("$SP.formfields.val: the array passed for val() must have the same size as the number of fields in formfields()");this.each(function(){this.val(e[o++])})}else this.each(function(){this.val(e)})}return this},elem:function(e){e=e!==!1;var t=[],r="function"==typeof jQuery&&e===!0;switch(this.each(function(){var e=this.elem(!1);e instanceof NodeList&&(e=[].slice.call(e)),t=t.concat(e)}),t.length){case 0:return r?jQuery():null;case 1:return r?jQuery(t[0]):t[0];default:return r?jQuery(t):t}},row:function(){var e=[],t="function"==typeof jQuery;switch(this.each(function(){var t=this.row();t instanceof jQuery==!0&&(t=t[0]),e.push(t)}),e.length){case 0:return t?jQuery():null;case 1:return t?jQuery(e[0]):e[0];default:return t?jQuery(e):e}},type:function(){var e=[];switch(this.each(function(){e.push(this.type())}),e.length){case 0:return"";case 1:return e[0];default:return e}},description:function(){var e=[];switch(this.each(function(){e.push(this.description())}),e.length){case 0:return"";case 1:return e[0];default:return e}},isMandatory:function(){var e=[];switch(this.each(function(){e.push(this.isMandatory())}),e.length){case 0:return!1;case 1:return e[0];default:return e}},name:function(){var e=[];switch(this.each(function(){e.push(this.name())}),e.length){case 0:return"";case 1:return e[0];default:return e}},internalname:function(){var e=[];switch(this.each(function(){e.push(this.internalname())}),e.length){case 0:return"";case 1:return e[0];default:return e}},notify:function(e,t){var r=this;if(e===undefined)throw"Error 'notify': you must provide the message to show.";if("string"!=typeof e)throw"Error 'notify': you must provide a string for the message to show.";if(t=t||{},t.timeout=isNaN(t.timeout)?5:t.timeout,t.override=t.override===!0,t.overrideAll=t.overrideAll===!0,t.overrideSticky=t.overrideSticky!==!1,t.sticky=t.sticky===!0,t.name=t.name||(new Date).getTime(),t.after=t.after||function(){},t.fake=t.fake===!0,t.ignoreQueue=t.ignoreQueue===!0,_SP_NOTIFY_READY===!1)return _SP_NOTIFY_QUEUE.push({message:e,options:t}),$(document).ready(function(){ExecuteOrDelayUntilScriptLoaded(function(){ExecuteOrDelayUntilScriptLoaded(function(){_SP_NOTIFY_READY=!0,r.notify("fake",{fake:!0})},"core.js")},"sp.js")}),r;if(t.ignoreQueue!==!0)for(;_SP_NOTIFY_QUEUE.length>0;){var n=_SP_NOTIFY_QUEUE.shift();n.options.ignoreQueue=!0,r.notify(n.message,n.options)}return t.fake!==!0?(_SP_NOTIFY.length>0&&(t.overrideAll?r.removeNotify({all:!0,includeSticky:t.overrideSticky}):t.override&&r.removeNotify(_SP_NOTIFY[_SP_NOTIFY.length-1].name)),_SP_NOTIFY.push({name:t.name,id:SP.UI.Notify.addNotification(e,!0),options:t}),t.sticky||setTimeout(function(){r.removeNotify(t.name,{timeout:!0})},1e3*t.timeout),r):void 0},removeNotify:function(e,t){var r=this;switch(arguments.length){case 0:throw"Error 'removeNotify': you must provide 'name' or 'options'.";case 2:if("object"!=typeof t)throw"Error 'removeNotify': you must provide an object for 'options'."}if(1===arguments.length&&"object"==typeof e&&(t=e,e=undefined),t=t||{all:!1},t.timeout=t.timeout===!0,_SP_NOTIFY_READY===!1&&_SP_NOTIFY_QUEUE.length>0)return setTimeout(function(){r.removeNotify(e,t)},150),r;var n;if(t.all===!0){for(var o=[];_SP_NOTIFY.length>0;)n=_SP_NOTIFY.shift(),
 t.includeSticky===!1&&n.options.sticky===!0?o.push(n):(SP.UI.Notify.removeNotification(n.id),setTimeout(function(){n.options.after.call(r,n.name,!1)},150));_SP_NOTIFY=o.slice(0)}else if(e!==undefined)for(var i=0,a=_SP_NOTIFY.length;a>i;i++)if(_SP_NOTIFY[i].name==e)return n=_SP_NOTIFY.splice(i,1)[0],SP.UI.Notify.removeNotification(n.id),setTimeout(function(){n.options.after.call(r,n.name,t.timeout)},150),r;return r},_getPageSize:function(e){var t={width:0,height:0},r={width:0,height:0},n=e||window,o=n.document,i=o.documentElement,a=o.getElementsByTagName("body")[0];return t.width=n.innerWidth||i.clientWidth||a.clientWidth,t.height=n.innerHeight||i.clientHeight||a.clientHeight,r.width=Math.max(a.scrollWidth,i.scrollWidth,a.offsetWidth,i.offsetWidth,a.clientWidth,i.clientWidth),r.height=Math.max(a.scrollHeight,i.scrollHeight,a.offsetHeight,i.offsetHeight,a.clientHeight,i.clientHeight),document.all&&document.querySelector&&!document.addEventListener&&t.width+4==r.width&&t.height+4==r.height&&(t.width=r.width,t.height=r.height),{vw:t,doc:r}},showModalDialog:function(e){function t(e,t){function r(){s||(s=!0,clearTimeout(a),t.call(this))}function n(){"complete"===this.readyState&&r.call(this)}function o(e,t,r){return e.addEventListener?e.addEventListener(t,r):e.attachEvent("on"+t,function(){return r.call(e,window.event)})}function i(){var t=e.contentDocument||e.contentWindow.document;0!==t.URL.indexOf("about:")?"complete"===t.readyState?r.call(t):(o(t,"DOMContentLoaded",r),o(t,"readystatechange",n)):a=setTimeout(i,1)}var a,s=!1;o(e,"load",function(){var t=e.contentDocument;t||(t=e.contentWindow,t&&(t=t.document)),t&&r.call(t)}),i()}var r=this;if(!_SP_MODALDIALOG_LOADED&&(_SP_MODALDIALOG_LOADED="object"==typeof SP&&"object"==typeof SP.UI&&"function"==typeof SP.UI.ModalDialog&&"function"==typeof SP.UI.ModalDialog.showModalDialog,!_SP_MODALDIALOG_LOADED))return LoadSodByKey("sp.ui.dialog.js",function(){_SP_MODALDIALOG_LOADED=!0,r.showModalDialog(e)}),r;var n,o;e.id=(e.id||"").replace(/\W+/g,""),e.id=e.id||(new Date).getTime();var i="sp_frame_"+e.id;e.html&&"string"==typeof e.html&&(o=document.createElement("div"),o.style.padding="10px",o.style.display="inline-block",o.className="sp-showModalDialog",o.id="content_"+i,o.innerHTML=e.html,e.html=o),"calculated"!==e.width&&"calculated"!==e.height||(n=r._getPageSize(),"calculated"===e.width&&(e.width=n.vw.width,e.width>768&&(e.width=2*e.width/3)),"calculated"===e.height&&(e.height=n.vw.height,e.height>576&&(e.height=90*e.height/100))),"full"!==e.width&&"full"!==e.height||(n=r._getPageSize(),"full"===e.width&&(e.width=n.vw.width),"full"===e.height&&(e.height=n.vw.height)),e.wait=e.wait===!0,e.closePrevious=e.closePrevious===!0,e.previousClose===!0&&(e.closePrevious=!0),e.closePrevious&&r.closeModalDialog(),e.showClose===!1&&(e.dialogReturnValueCallback||e.callback)&&(e.showClose=!0,e.hideClose=!0);var a=e.dialogReturnValueCallback||e.callback||function(){};e.dialogReturnValueCallback=function(e,t){var r,n;if("object"==typeof e&&"undefined"!=typeof e.type&&"closeModalDialog"===e.type){var o=e;e=o.dialogResult,t=o.returnValue,r=o.id}if(r)for(var i=0;i<window.top._SP_MODALDIALOG.length;i++)if(window.top._SP_MODALDIALOG[i].id===r){n=window.top._SP_MODALDIALOG.splice(i,1),n=n[0];break}n||(n=window.top._SP_MODALDIALOG.pop()),window.top.document.body.removeChild(window.top.document.getElementById("style_"+n.id)),a.call(this,e,t)};var s=function(){var r=e.wait?SP.UI.ModalDialog.showWaitScreenWithNoClose(e.title,e.message,e.height,e.width):SP.UI.ModalDialog.showModalDialog(e),n=window.top,o=i,a=n.document.querySelectorAll("body > iframe"),s=a[a.length-1],l=0;if(s.setAttribute("id",o),"undefined"==typeof n._SP_MODALDIALOG&&(n._SP_MODALDIALOG=[]),n._SP_MODALDIALOG.push({id:o,modal:r,zIndex:s.style.zIndex,options:e,type:"modalDialog"}),SPArrayForEach(n._SP_MODALDIALOG,function(e){e.zIndex>l&&(l=e.zIndex)}),l--,n.document.body.insertAdjacentHTML("beforeend",'<style id="style_'+o+'">.ms-dlgOverlay { z-index:'+l+" !important; display:block !important }</style>"),e.hideClose===!0){var u=s.nextSibling.querySelector(".ms-dlgCloseBtn");u.parentNode.removeChild(u)}if("function"==typeof e.onload&&e.onload(),e.url&&e.onurlload&&"function"==typeof e.onurlload){var c=n.document.getElementById(o);c&&(c=c.nextSibling),c&&(c=c.querySelector("iframe")),c&&t(c,e.onurlload)}};SP.SOD.executeOrDelayUntilScriptLoaded(s,"sp.ui.dialog.js")},closeModalDialog:function(e,t){var r=function(){var r;if("object"==typeof e&&"undefined"!=typeof e.type&&"modalDialog"===e.type)r={id:e.id,dialogResult:t,returnValue:undefined,type:"closeModalDialog"},e.modal.close(r),e.options.wait&&e.options.dialogReturnValueCallback(r,t);else{if("undefined"!=typeof window.top._SP_MODALDIALOG&&(r=window.top._SP_MODALDIALOG,r.length>0))return r=r[r.length-1],r.modal.close({id:r.id,dialogResult:e,returnValue:t,type:"closeModalDialog"}),r.options.wait&&r.options.dialogReturnValueCallback(e,t),!1;SP.UI.ModalDialog.commonModalDialogClose(e,t)}};return SP.SOD.executeOrDelayUntilScriptLoaded(r,"sp.ui.dialog.js"),!1},getModalDialog:function(e){if("undefined"!=typeof window.top._SP_MODALDIALOG){var t=window.top._SP_MODALDIALOG;e=e.replace(/\W+/g,"");for(var r=0;r<t.length;r++)if(t[r].id==="sp_frame_"+e)return t[r]}return null},waitModalDialog:function(e,t,r,n){return this.showModalDialog({wait:!0,title:e||"Working...",message:t,width:n,height:r})},resizeModalDialog:function(e){var t,r,n,o,i,a=function(e){return 1*e.replace(/px/,"")},s=window.top;if(!e.id){if(0===s._SP_MODALDIALOG.length)return!1;e.id=s._SP_MODALDIALOG[s._SP_MODALDIALOG.length-1].id.replace(/sp_frame_/,"")}if(t=s.document.getElementById("sp_frame_"+e.id),!t)return!1;t=t.nextSibling,e.width=e.width===undefined?a(t.style.width):e.width,e.height=e.height===undefined?a(t.style.height):e.height,r={Border:t.querySelector(".ms-dlgBorder"),TitleText:t.querySelector(".ms-dlgTitleText"),Content:t,Frame:t.querySelector(".ms-dlgFrame")},n=e.width-a(r.Border.style.width),o=e.height-a(r.Border.style.height);for(i in r)r.hasOwnProperty(i)&&r[i]&&(r[i].style.width=a(r[i].style.width)+n+"px","TitleText"!==i&&(r[i].style.height=a(r[i].style.height)+o+"px"));var l=this._getPageSize(s);t.style.top=l.vw.height/2-a(t.style.height)/2+"px",t.style.left=l.vw.width/2-a(t.style.width)/2+"px"},registerPlugin:function(e,t){if("undefined"!=typeof _SP_PLUGINS[e])throw"Error 'registerPlugin': '"+e+"' is already registered.";return _SP_PLUGINS[e]=t,!0},plugin:function(e,t){if(t=t||{},"function"!=typeof _SP_PLUGINS[e])throw"Error $SP().plugin: the plugin '"+e+"' is not registered.";return _SP_PLUGINS[e].call(this,t),this}};var myElem=function(){var e=function(e){return new t(e)},t=function(e){return this.mynode=e,this.singleList=!0,this};return e.fn=t.prototype={getAttribute:function(e){return this.mynode.getAttribute("ows_"+e.replace(/ /g,""))},getAttributes:function(){return this.mynode.attributes}},e}(),extendMyObject=function(e){this.attributes=e};return extendMyObject.prototype.getAttribute=function(e){return this.attributes[e]},extendMyObject.prototype.getAttributes=function(){return this.attributes},SharepointPlus.prototype.noConflict=function(){window._$SP=window._SharepointPlus=window.$SP},_SP_ISBROWSER||"undefined"==typeof exports?window.$SP=window.SharepointPlus=SharepointPlus:("undefined"!=typeof module&&module.exports&&(exports=module.exports=SharepointPlus),exports.SharepointPlus=SharepointPlus),SharepointPlus}(this,"undefined"!=typeof document?document:null);
